import{p as S,r as n,q as l,j as s,B as m,T as c,L as k,P as v,a2 as E,w as P,a3 as I,I as y}from"./index-ik9JjyS6.js";import{u as L}from"./useNotification-DgBW3D1z.js";import{C as A}from"./ConsultationTemplateBuilder-DSYZbycH.js";import{B as $}from"./Button-B6n5coYQ.js";import{A as N}from"./Add-BfAxRG2-.js";import{A as W}from"./Alert-Dzq7_ew3.js";import{C as O}from"./Chip-pTV9ioJu.js";import{S as U}from"./Stack-DcOE3fMJ.js";import{E as q}from"./Edit-DimIYhJX.js";import{D as H}from"./Delete-rK6RFrLt.js";import{D as K,b as M}from"./DialogTitle-DX1gnFsJ.js";import"./Grid-OOY2WAvo.js";import"./useThemeProps-C_QfMg4i.js";import"./TextField-BNTsiTHM.js";import"./Select--zggdXop.js";import"./Switch-CMxXGKKJ.js";import"./DragIndicator-DX-HaPvZ.js";import"./MenuItem-cD7WzH5Q.js";import"./Cancel-CjIxMi8f.js";import"./Save-BBUZJYPl.js";function ue(){S();const[f,g]=n.useState([]),[j,h]=n.useState(!0),[w,i]=n.useState(!1),[z,r]=n.useState(null),{success:u,error:d}=L();n.useEffect(()=>{p()},[]);const p=async()=>{try{h(!0);const e=await l.get("/consultation-templates");console.log("[ConsultationTemplatesPage] Templates response:",e.data);const t=e.data.templates||[];console.log("[ConsultationTemplatesPage] Templates count:",t.length),t.forEach(a=>{var o;console.log(`[ConsultationTemplatesPage] Template: ${a.name}, isDefault: ${a.isDefault}, fields: ${((o=a.fields)==null?void 0:o.length)||0}`)}),g(t)}catch(e){console.error("Błąd pobierania szablonów:",e),d("Błąd pobierania szablonów")}finally{h(!1)}},b=()=>{r(null),i(!0)},T=e=>{r(e),i(!0)},C=async e=>{if(window.confirm("Czy na pewno chcesz usunąć ten szablon?"))try{await l.delete(`/consultation-templates/${e}`),u("Szablon usunięty"),p()}catch(t){console.error("Błąd usuwania szablonu:",t),d("Błąd usuwania szablonu")}},D=async e=>{var t,a;try{e.id?(await l.put(`/consultation-templates/${e.id}`,e),u("Szablon zaktualizowany")):(await l.post("/consultation-templates",e),u("Szablon utworzony")),i(!1),r(null),p()}catch(o){console.error("Błąd zapisywania szablonu:",o);const B=((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.error)||"Błąd zapisywania szablonu";d(B)}},x=()=>{i(!1),r(null)};return s.jsxs(m,{sx:{p:3},children:[s.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[s.jsx(c,{variant:"h4",sx:{fontWeight:"bold"},children:"Szablony kart konsultacji"}),s.jsx($,{variant:"contained",startIcon:s.jsx(N,{}),onClick:b,children:"Nowy szablon"})]}),j?s.jsx(c,{children:"Ładowanie..."}):f.length===0?s.jsx(W,{severity:"info",children:'Brak szablonów. Kliknij "Nowy szablon", aby utworzyć pierwszy szablon.'}):s.jsx(k,{children:f.sort((e,t)=>e.isDefault&&!t.isDefault?-1:!e.isDefault&&t.isDefault?1:0).map(e=>s.jsx(v,{sx:{mb:2},children:s.jsxs(E,{children:[s.jsx(P,{primary:s.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(c,{variant:"h6",children:e.name}),e.isDefault&&s.jsx(O,{label:"Domyślny (Standardowy arkusz)",color:"primary",size:"small"})]}),secondary:s.jsxs(c,{variant:"body2",color:"text.secondary",children:[e.fields.length," ",e.fields.length===1?"pole":"pól",e.isDefault&&" • Używany automatycznie przy tworzeniu nowej konsultacji"]})}),s.jsx(I,{children:s.jsxs(U,{direction:"row",spacing:1,children:[s.jsx(y,{edge:"end",color:"primary",onClick:()=>{console.log("[ConsultationTemplatesPage] Editing template:",e),T(e)},title:"Edytuj szablon",children:s.jsx(q,{})}),!e.isDefault&&e.id&&s.jsx(y,{edge:"end",color:"error",onClick:()=>C(e.id),title:"Usuń szablon",children:s.jsx(H,{})})]})})]})},e.id))}),s.jsx(K,{open:w,onClose:x,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"90vh",maxHeight:"90vh"}},children:s.jsx(M,{sx:{p:0,overflow:"auto"},children:s.jsx(A,{template:z,onSave:D,onCancel:x})})})]})}export{ue as default};
