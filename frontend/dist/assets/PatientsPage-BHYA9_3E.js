import{c as ne,j as e,u as Ce,r as n,p as ke,n as Pe,o as We,q as f,B as o,T as l,C as $,P as Q,A as X,t as k,I as d,E as ve}from"./index-DuGlS2hS.js";import{u as Ne}from"./useNotification-DEJT79vM.js";import{E as Ie,P as De,D as Te}from"./ErrorRetry-BkhO0ssf.js";import{C as Ae}from"./Container-DggLIBHC.js";import{B as x}from"./Button-DYA-l7Ix.js";import{A as Ee,R as Re}from"./Restore-CO_ljNLX.js";import{A as $e}from"./Add-CyAZE82m.js";import{T as Oe}from"./TextField-VtT5fMIl.js";import{I as Be}from"./InputAdornment-BplF7Ie4.js";import{S as Me}from"./Search-CdCexvfx.js";import{G as P}from"./Grid-9JmJah-6.js";import{C as ee}from"./Card-BZPW2CFi.js";import{C as se}from"./CardContent-DyGdFslf.js";import{V as re}from"./Visibility-zS0Eo4-i.js";import{D as ae}from"./Delete-XwNcIwF-.js";import{S as Le}from"./Stack-DKrDn8iz.js";import{T as Fe,a as Ue,b as He,c as W,d as i,e as Ze}from"./TableRow-B0Vjdlj8.js";import{C as Ge}from"./Chip-CKQ1KLG2.js";import{T as Ve}from"./TablePagination-CyCLUKXI.js";import{D as O,a as B,b as M,c as L}from"./DialogTitle-Cnb6c1S1.js";import{D as F}from"./KeyboardArrowRight-CcXDP3W7.js";import"./Alert-BnPrPNDn.js";import"./Refresh-CYwZfv-e.js";import"./useThemeProps-CESs6Os5.js";import"./Select-DgRGz9X7.js";import"./MenuItem-0hJOb36H.js";const Je=ne(e.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"})),te=ne(e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}));function Ss(){const{user:c}=Ce(),[g,ie]=n.useState([]),[U,H]=n.useState(!0),[v,Z]=n.useState(!1),[N,z]=n.useState(0),[I,oe]=n.useState(10),[D,le]=n.useState(""),[ce,xe]=n.useState(0),[m,me]=n.useState(!1),[w,T]=n.useState({open:!1,patientId:null,patientName:""}),[y,A]=n.useState({open:!1,patientId:null,patientName:""}),[b,E]=n.useState({open:!1,patientId:null,patientName:""}),[Ke,de]=n.useState(""),[Ye,_e]=n.useState(""),[G,R]=n.useState(null),{success:S,error:C}=Ne(),p=ke(),h=Pe(),a=We(h.breakpoints.down("md")),pe=(c==null?void 0:c.role)==="ADMIN"||(c==null?void 0:c.role)==="DOCTOR",he=(c==null?void 0:c.role)==="ADMIN";n.useEffect(()=>{j()},[N,I,D,m]);const j=async()=>{var s,r;try{H(!0),R(null);const t=await f.get("/patients",{params:{page:N+1,limit:I,search:D,archived:m},_skipErrorToast:!0});ie(t.data.patients),xe(t.data.pagination.total)}catch(t){console.error("Błąd pobierania pacjentów:",t),R(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||"Nie udało się załadować listy pacjentów")}finally{H(!1)}},je=(s,r)=>{z(r)},ue=s=>{oe(parseInt(s.target.value,10)),z(0)},V=(s,r)=>{T({open:!0,patientId:s,patientName:r})},fe=async()=>{var s,r;if(w.patientId)try{await f.delete(`/patients/${w.patientId}`),S("Pacjent został zarchiwizowany"),T({open:!1,patientId:null,patientName:""}),j()}catch(t){C(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||"Błąd podczas usuwania pacjenta")}},J=()=>{T({open:!1,patientId:null,patientName:""})},ge=(s,r)=>{A({open:!0,patientId:s,patientName:r})},ze=async()=>{var s,r;if(y.patientId)try{await f.post(`/patients/${y.patientId}/restore`),S("Pacjent został przywrócony"),A({open:!1,patientId:null,patientName:""}),j()}catch(t){C(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||"Błąd podczas przywracania pacjenta")}},K=()=>{A({open:!1,patientId:null,patientName:""})},we=(s,r)=>{E({open:!0,patientId:s,patientName:r})},ye=async()=>{var s,r;if(b.patientId)try{await f.delete(`/patients/${b.patientId}/permanent`),S("Pacjent i wszystkie dane zostały trwale usunięte zgodnie z RODO"),E({open:!1,patientId:null,patientName:""}),j()}catch(t){C(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||"Błąd podczas trwałego usuwania pacjenta")}},Y=()=>{E({open:!1,patientId:null,patientName:""})},be=async()=>{var s,r;try{Z(!0),de("");const t=await f.get("/export/patients/zip",{responseType:"blob"}),q=window.URL.createObjectURL(new Blob([t.data])),u=document.createElement("a");u.href=q;const Se=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);u.setAttribute("download",`eksport-pacjentow-${Se}.zip`),document.body.appendChild(u),u.click(),u.remove(),window.URL.revokeObjectURL(q),S("Eksport zakończony pomyślnie")}catch(t){console.error("Błąd eksportu:",t),C(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||"Błąd podczas eksportu danych")}finally{Z(!1)}},_=(s,r)=>`${s.charAt(0)}${r.charAt(0)}`.toUpperCase();return e.jsx(Ae,{maxWidth:"xl",sx:{px:{xs:1,sm:2,md:3}},children:e.jsxs(o,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(o,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:{xs:1.5,sm:2},gap:{xs:1.5,sm:2}},children:[e.jsxs(o,{sx:{width:{xs:"100%",sm:"auto"}},children:[e.jsx(l,{variant:"h4",component:"h1",sx:{fontWeight:800,mb:1,fontSize:{xs:"1.75rem",sm:"2.5rem"},background:"linear-gradient(135deg, #007AFF 0%, #00C7BE 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Pacjenci"}),e.jsx(l,{variant:"body1",color:"text.secondary",sx:{fontSize:{xs:"0.875rem",sm:"1rem"},fontWeight:500},children:"Zarządzaj bazą pacjentów i ich historią medyczną"})]}),e.jsxs(o,{sx:{display:"flex",gap:{xs:1,sm:2},flexWrap:"wrap",width:{xs:"100%",sm:"auto"},"& > *":{flex:{xs:"1 1 auto",sm:"0 0 auto"},minWidth:{xs:"auto",sm:"120px"}}},children:[e.jsx(x,{variant:m?"outlined":"contained",startIcon:e.jsx(Ee,{}),onClick:()=>{me(!m),z(0)},sx:{textTransform:"none",fontWeight:600,fontSize:{xs:"0.75rem",sm:"0.875rem"},px:{xs:1.5,sm:2}},size:a?"small":"medium",children:m?"Aktywni":"Zarchiwizowani"}),pe&&!m&&e.jsx(x,{variant:"outlined",startIcon:v?e.jsx($,{size:20}):e.jsx(Je,{}),onClick:be,disabled:v,sx:{textTransform:"none",fontWeight:600,fontSize:{xs:"0.75rem",sm:"0.875rem"},px:{xs:1.5,sm:2}},size:a?"small":"medium",children:v?a?"Eksport...":"Eksportowanie...":a?"Eksport":"Eksportuj dane"}),!m&&e.jsx(x,{variant:"contained",startIcon:e.jsx($e,{}),onClick:()=>p("/patients/new"),sx:{textTransform:"none",fontWeight:700,borderRadius:2,fontSize:{xs:"0.8125rem",sm:"0.875rem"},px:{xs:2,sm:3},py:1.2},size:"medium",fullWidth:a,children:"NOWY PACJENT"})]})]}),G&&e.jsx(Ie,{message:G,onRetry:j,onClose:()=>R(null)}),e.jsx(Q,{sx:{p:{xs:1,sm:2},mb:4,borderRadius:3,border:"1px solid",borderColor:"divider",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:e.jsx(Oe,{fullWidth:!0,placeholder:a?"Szukaj pacjenta...":"Szukaj po imieniu, nazwisku, nr telefonu lub emailu...",value:D,onChange:s=>{le(s.target.value),z(0)},size:a?"small":"medium",InputProps:{startAdornment:e.jsx(Be,{position:"start",children:e.jsx(Me,{sx:{color:"primary.main"},fontSize:a?"small":"medium"})}),sx:{borderRadius:2.5}}})}),a?e.jsx(P,{container:!0,spacing:2,children:U?e.jsx(P,{size:{xs:12},children:e.jsx(o,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx($,{})})}):g.length===0?e.jsx(P,{size:{xs:12},children:e.jsx(ee,{children:e.jsx(se,{children:e.jsxs(o,{sx:{textAlign:"center",py:4},children:[e.jsx(te,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(l,{color:"text.secondary",children:"Brak pacjentów"})]})})})}):g.map(s=>e.jsx(P,{size:{xs:12},children:e.jsx(ee,{sx:{borderRadius:3,border:"1px solid",borderColor:"divider",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",transition:"all 0.2s ease-in-out","&:active":{transform:"scale(0.98)"}},onClick:()=>p(`/patients/${s.id}`),children:e.jsxs(se,{sx:{p:2.5},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(X,{sx:{width:50,height:50,bgcolor:k(h.palette.primary.main,.1),color:"primary.main",fontWeight:700,fontSize:"1.2rem",border:`2px solid ${k(h.palette.primary.main,.2)}`},children:_(s.firstName,s.lastName)}),e.jsxs(o,{children:[e.jsxs(l,{variant:"subtitle1",sx:{fontWeight:700,lineHeight:1.2},children:[s.firstName," ",s.lastName]}),e.jsxs(l,{variant:"caption",color:"text.secondary",sx:{fontWeight:500},children:[s.age?`${s.age} lat`:"Wiek nieznany"," • ",s.gender==="MALE"?"Mężczyzna":"Kobieta"]})]})]}),e.jsxs(o,{sx:{display:"flex"},children:[e.jsx(d,{size:"small",onClick:r=>{r.stopPropagation(),p(`/patients/${s.id}`)},sx:{color:"primary.main",bgcolor:k(h.palette.primary.main,.05),mr:.5},children:e.jsx(re,{fontSize:"small"})}),e.jsx(d,{size:"small",color:"error",onClick:r=>{r.stopPropagation(),V(s.id,`${s.firstName} ${s.lastName}`)},sx:{bgcolor:k(h.palette.error.main,.05)},children:e.jsx(ae,{fontSize:"small"})})]})]}),e.jsxs(Le,{spacing:1,children:[s.phone&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(l,{variant:"body2",color:"text.primary",sx:{fontWeight:500},children:s.phone})]}),s.email&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ve,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(l,{noWrap:!0,variant:"body2",color:"text.primary",sx:{fontWeight:500},children:s.email})]})]})]})})},s.id))}):e.jsxs(Fe,{component:Q,sx:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:[e.jsxs(Ue,{sx:{minWidth:650},children:[e.jsx(He,{children:e.jsxs(W,{children:[e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontWeight:600,whiteSpace:"nowrap"},children:"Imię i nazwisko"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:"Wiek"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:"Płeć"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap",display:{xs:"none",md:"table-cell"}},children:"Telefon"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap",display:{xs:"none",lg:"table-cell"}},children:"Email"}),e.jsx(i,{align:"right",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:"Akcje"})]})}),e.jsx(Ze,{children:U?e.jsx(W,{children:e.jsx(i,{colSpan:6,align:"center",sx:{py:4},children:e.jsx($,{})})}):g.length===0?e.jsx(W,{children:e.jsxs(i,{colSpan:6,align:"center",sx:{py:4},children:[e.jsx(te,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(l,{color:"text.secondary",children:"Brak pacjentów"})]})}):g.map(s=>e.jsxs(W,{hover:!0,sx:{cursor:"pointer"},onClick:()=>p(`/patients/${s.id}`),children:[e.jsx(i,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(X,{sx:{bgcolor:"primary.main",width:40,height:40,fontSize:"0.9rem",fontWeight:"bold"},children:_(s.firstName,s.lastName)}),e.jsxs(l,{sx:{fontWeight:500},children:[s.firstName," ",s.lastName]})]})}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.age||"-"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.gender&&e.jsx(Ge,{label:s.gender==="MALE"?"M":s.gender==="FEMALE"?"K":"-",size:"small",color:s.gender==="MALE"?"primary":"secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"},height:{xs:20,sm:24}}})}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},display:{xs:"none",md:"table-cell"}},children:s.phone||"-"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},display:{xs:"none",lg:"table-cell"},maxWidth:{lg:200},overflow:"hidden",textOverflow:"ellipsis"},children:s.email||"-"}),e.jsxs(i,{align:"right",children:[e.jsx(d,{size:"small",onClick:r=>{r.stopPropagation(),p(`/patients/${s.id}`)},children:e.jsx(re,{})}),m?e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"small",color:"success",onClick:r=>{r.stopPropagation(),ge(s.id,`${s.firstName} ${s.lastName}`)},title:"Przywróć pacjenta",children:e.jsx(Re,{})}),he&&e.jsx(d,{size:"small",color:"error",onClick:r=>{r.stopPropagation(),we(s.id,`${s.firstName} ${s.lastName}`)},title:"Trwale usuń (RODO)",children:e.jsx(Te,{})})]}):e.jsx(d,{size:"small",color:"error",onClick:r=>{r.stopPropagation(),V(s.id,`${s.firstName} ${s.lastName}`)},children:e.jsx(ae,{})})]})]},s.id))})]}),e.jsx(Ve,{component:"div",count:ce,page:N,onPageChange:je,rowsPerPage:I,onRowsPerPageChange:ue,rowsPerPageOptions:[10,25,50],labelRowsPerPage:a?"Na stronie:":"Wierszy na stronę:",sx:{"& .MuiTablePagination-toolbar":{flexWrap:"wrap",gap:1},"& .MuiTablePagination-selectLabel, & .MuiTablePagination-displayedRows":{fontSize:{xs:"0.75rem",sm:"0.875rem"}}}})]}),e.jsxs(O,{open:w.open,onClose:J,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{m:{xs:2,sm:3},width:{xs:"calc(100% - 32px)",sm:"auto"}}},children:[e.jsx(B,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Potwierdzenie usunięcia"}),e.jsx(M,{children:e.jsxs(F,{sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:["Czy na pewno chcesz zarchiwizować pacjenta ",e.jsx("strong",{children:w.patientName}),"?",e.jsx(l,{variant:"body2",color:"warning.main",sx:{mt:2,p:{xs:1.5,sm:2},bgcolor:"warning.50",borderRadius:1,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:"⚠️ Uwaga: Pacjent zostanie zarchiwizowany (soft delete). Wszystkie powiązane dane pozostaną w systemie."})]})}),e.jsxs(L,{sx:{px:{xs:2,sm:3},pb:{xs:2,sm:3}},children:[e.jsx(x,{onClick:J,size:a?"small":"medium",children:"Anuluj"}),e.jsx(x,{onClick:fe,color:"error",variant:"contained",size:a?"small":"medium",children:"Zarchiwizuj"})]})]}),e.jsxs(O,{open:y.open,onClose:K,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{m:{xs:2,sm:3},width:{xs:"calc(100% - 32px)",sm:"auto"}}},children:[e.jsx(B,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Przywróć pacjenta"}),e.jsx(M,{children:e.jsxs(F,{sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:["Czy na pewno chcesz przywrócić pacjenta ",e.jsx("strong",{children:y.patientName}),"? Pacjent zostanie przywrócony do aktywnej listy."]})}),e.jsxs(L,{sx:{px:{xs:2,sm:3},pb:{xs:2,sm:3}},children:[e.jsx(x,{onClick:K,size:a?"small":"medium",children:"Anuluj"}),e.jsx(x,{onClick:ze,color:"success",variant:"contained",size:a?"small":"medium",children:"Przywróć"})]})]}),e.jsxs(O,{open:b.open,onClose:Y,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{m:{xs:2,sm:3},width:{xs:"calc(100% - 32px)",sm:"auto"}}},children:[e.jsx(B,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Trwałe usunięcie danych (RODO)"}),e.jsx(M,{children:e.jsxs(F,{sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:[e.jsx("strong",{children:"UWAGA: Ta operacja jest nieodwracalna!"}),e.jsx("br",{}),e.jsx("br",{}),"Czy na pewno chcesz trwale usunąć pacjenta ",e.jsx("strong",{children:b.patientName})," i wszystkie powiązane dane?",e.jsx("br",{}),e.jsx("br",{}),"Zostaną usunięte:",e.jsxs("ul",{style:{marginLeft:a?"16px":"20px",paddingLeft:a?"8px":"12px",fontSize:a?"0.875rem":"1rem"},children:[e.jsx("li",{children:"Wszystkie konsultacje"}),e.jsx("li",{children:"Wszystkie wyniki badań"}),e.jsx("li",{children:"Wszystkie zdjęcia skóry głowy (również pliki)"}),e.jsx("li",{children:"Wszystkie plany opieki"}),e.jsx("li",{children:"Historia emaili"}),e.jsx("li",{children:"Wszystkie przypomnienia"})]}),"Ta operacja jest zgodna z RODO i nie może być cofnięta."]})}),e.jsxs(L,{sx:{px:{xs:2,sm:3},pb:{xs:2,sm:3}},children:[e.jsx(x,{onClick:Y,size:a?"small":"medium",children:"Anuluj"}),e.jsx(x,{onClick:ye,color:"error",variant:"contained",size:a?"small":"medium",children:"Trwale usuń"})]})]})]})})}export{Ss as default};
