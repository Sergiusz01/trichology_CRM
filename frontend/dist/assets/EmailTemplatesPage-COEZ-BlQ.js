import{r,n as $,o as Q,q as h,j as e,B as z,T as D,P as X,I as A}from"./index-DuGlS2hS.js";import{B as x}from"./Button-DYA-l7Ix.js";import{R as Y}from"./Refresh-CYwZfv-e.js";import{A as Z}from"./Add-CyAZE82m.js";import{A as b}from"./Alert-BnPrPNDn.js";import{T as G,a as J,b as V,c as k,d as t,e as ee}from"./TableRow-B0Vjdlj8.js";import{C as N}from"./Chip-CKQ1KLG2.js";import{C as se}from"./CheckCircle-Cw3GtUAD.js";import{E as ae}from"./Edit-CC4dElt7.js";import{D as te}from"./Delete-XwNcIwF-.js";import{D as W,a as B,b as O,c as I}from"./DialogTitle-Cnb6c1S1.js";import{T as w,F as le,I as ie}from"./TextField-VtT5fMIl.js";import{S as ne}from"./Select-DgRGz9X7.js";import{M as S}from"./MenuItem-0hJOb36H.js";import{F as L,a as E}from"./Switch-BJM11GRR.js";function Se(){const[U,P]=r.useState([]),M=$(),l=Q(M.breakpoints.down("sm")),[R,v]=r.useState(!1),[F,p]=r.useState(!1),[o,d]=r.useState(null),[a,i]=r.useState({name:"",type:"CONSULTATION",subject:"",htmlBody:"",textBody:"",isDefault:!1,isActive:!0}),[f,m]=r.useState(""),[j,c]=r.useState(""),[q,T]=r.useState(!1);r.useEffect(()=>{y()},[]);const y=async()=>{try{const s=await h.get("/email-templates");P(s.data.templates)}catch(s){console.error("Błąd pobierania szablonów:",s)}},C=s=>{s?(d(s),i({name:s.name,type:s.type,subject:s.subject,htmlBody:s.htmlBody,textBody:s.textBody||"",isDefault:s.isDefault,isActive:s.isActive})):(d(null),i({name:"",type:"CONSULTATION",subject:"",htmlBody:"",textBody:"",isDefault:!1,isActive:!0})),v(!0),m(""),c("")},g=()=>{v(!1),d(null),m(""),c("")},_=async()=>{var s,n;try{m(""),c(""),o?(await h.put(`/email-templates/${o.id}`,a),c("Szablon został zaktualizowany")):(await h.post("/email-templates",a),c("Szablon został utworzony")),setTimeout(()=>{g(),y()},1e3)}catch(u){m(((n=(s=u.response)==null?void 0:s.data)==null?void 0:n.error)||"Wystąpił błąd")}},H=async()=>{var s,n;try{await h.delete(`/email-templates/${o.id}`),p(!1),d(null),y()}catch(u){m(((n=(s=u.response)==null?void 0:s.data)==null?void 0:n.error)||"Wystąpił błąd")}},K=s=>({CONSULTATION:"Konsultacja",CARE_PLAN:"Plan opieki",LAB_RESULT:"Wynik badania",CUSTOM:"Niestandardowy"})[s]||s;return e.jsxs(z,{sx:{width:"100%",maxWidth:"100%",overflow:"hidden"},children:[e.jsxs(z,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:{xs:2,sm:3},gap:{xs:1.5,sm:2}},children:[e.jsx(D,{variant:"h4",sx:{fontSize:{xs:"1.5rem",sm:"2rem"},fontWeight:"bold"},children:"Szablony emaili"}),e.jsxs(z,{sx:{display:"flex",gap:{xs:1,sm:2},flexWrap:"wrap",width:{xs:"100%",sm:"auto"}},children:[e.jsx(x,{variant:"outlined",startIcon:e.jsx(Y,{}),onClick:async()=>{var s,n;try{T(!0),m(""),await h.post("/email-templates/initialize-defaults"),c("Domyślne szablony zostały zainicjalizowane"),y(),setTimeout(()=>c(""),3e3)}catch(u){m(((n=(s=u.response)==null?void 0:s.data)==null?void 0:n.error)||"Wystąpił błąd podczas inicjalizacji")}finally{T(!1)}},disabled:q,size:l?"small":"medium",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},flex:{xs:"1 1 auto",sm:"0 0 auto"}},children:l?"Inicjalizuj":"Inicjalizuj domyślne"}),e.jsx(x,{variant:"contained",startIcon:e.jsx(Z,{}),onClick:()=>C(),size:l?"small":"medium",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},flex:{xs:"1 1 auto",sm:"0 0 auto"}},children:l?"Nowy":"Nowy szablon"})]})]}),f&&e.jsx(b,{severity:"error",sx:{mb:2},children:f}),j&&e.jsx(b,{severity:"success",sx:{mb:2},children:j}),e.jsx(X,{sx:{overflow:"hidden"},children:e.jsx(G,{sx:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:e.jsxs(J,{sx:{minWidth:600},children:[e.jsx(V,{children:e.jsxs(k,{children:[e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontWeight:600,whiteSpace:"nowrap"},children:"Nazwa"}),e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:"Typ"}),e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap",display:{xs:"none",md:"table-cell"}},children:"Temat"}),e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap",display:{xs:"none",sm:"table-cell"}},children:"Domyślny"}),e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap",display:{xs:"none",sm:"table-cell"}},children:"Aktywny"}),e.jsx(t,{align:"right",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:"Akcje"})]})}),e.jsx(ee,{children:U.map(s=>e.jsxs(k,{children:[e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},maxWidth:{xs:150,sm:"none"},overflow:"hidden",textOverflow:"ellipsis"},children:s.name}),e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:e.jsx(N,{label:K(s.type),size:"small",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"},height:{xs:20,sm:24}}})}),e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},display:{xs:"none",md:"table-cell"},maxWidth:200,overflow:"hidden",textOverflow:"ellipsis"},children:s.subject}),e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},display:{xs:"none",sm:"table-cell"}},children:s.isDefault&&e.jsx(se,{color:"primary",fontSize:l?"small":"medium"})}),e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},display:{xs:"none",sm:"table-cell"}},children:e.jsx(N,{label:s.isActive?"Tak":"Nie",color:s.isActive?"success":"default",size:"small",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"},height:{xs:20,sm:24}}})}),e.jsxs(t,{align:"right",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:[e.jsx(A,{size:"small",onClick:()=>C(s),color:"primary",children:e.jsx(ae,{fontSize:l?"small":"medium"})}),e.jsx(A,{size:"small",onClick:()=>{d(s),p(!0)},color:"error",children:e.jsx(te,{fontSize:l?"small":"medium"})})]})]},s.id))})]})})}),e.jsxs(W,{open:R,onClose:g,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{m:{xs:2,sm:3},width:{xs:"calc(100% - 32px)",sm:"auto"},maxHeight:{xs:"90vh",sm:"none"}}},children:[e.jsx(B,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:o?"Edytuj szablon":"Nowy szablon"}),e.jsxs(O,{sx:{overflowY:{xs:"auto",sm:"visible"},px:{xs:1.5,sm:3}},children:[f&&e.jsx(b,{severity:"error",sx:{mb:2},children:f}),j&&e.jsx(b,{severity:"success",sx:{mb:2},children:j}),e.jsxs(z,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(w,{label:"Nazwa szablonu",value:a.name,onChange:s=>i({...a,name:s.target.value}),fullWidth:!0,required:!0}),e.jsxs(le,{fullWidth:!0,children:[e.jsx(ie,{children:"Typ"}),e.jsxs(ne,{value:a.type,onChange:s=>i({...a,type:s.target.value}),label:"Typ",children:[e.jsx(S,{value:"CONSULTATION",children:"Konsultacja"}),e.jsx(S,{value:"CARE_PLAN",children:"Plan opieki"}),e.jsx(S,{value:"LAB_RESULT",children:"Wynik badania"}),e.jsx(S,{value:"CUSTOM",children:"Niestandardowy"})]})]}),e.jsx(w,{label:"Temat emaila",value:a.subject,onChange:s=>i({...a,subject:s.target.value}),fullWidth:!0,required:!0,helperText:"Możesz użyć zmiennych: {{patientName}}, {{doctorName}}, {{consultationDate}}, itp."}),e.jsx(w,{label:"Treść HTML",value:a.htmlBody,onChange:s=>i({...a,htmlBody:s.target.value}),fullWidth:!0,required:!0,multiline:!0,rows:10,helperText:"Możesz użyć zmiennych: {{patientName}}, {{doctorName}}, {{consultationDate}}, itp."}),e.jsx(w,{label:"Treść tekstowa (opcjonalna)",value:a.textBody,onChange:s=>i({...a,textBody:s.target.value}),fullWidth:!0,multiline:!0,rows:5}),e.jsx(L,{control:e.jsx(E,{checked:a.isDefault,onChange:s=>i({...a,isDefault:s.target.checked})}),label:"Ustaw jako domyślny szablon dla tego typu"}),e.jsx(L,{control:e.jsx(E,{checked:a.isActive,onChange:s=>i({...a,isActive:s.target.checked})}),label:"Aktywny"})]})]}),e.jsxs(I,{sx:{px:{xs:2,sm:3},pb:{xs:2,sm:3}},children:[e.jsx(x,{onClick:g,size:l?"small":"medium",children:"Anuluj"}),e.jsx(x,{onClick:_,variant:"contained",size:l?"small":"medium",children:o?"Zapisz":"Utwórz"})]})]}),e.jsxs(W,{open:F,onClose:()=>p(!1),fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{m:{xs:2,sm:3},width:{xs:"calc(100% - 32px)",sm:"auto"}}},children:[e.jsx(B,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Usuń szablon"}),e.jsx(O,{children:e.jsxs(D,{sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:["Czy na pewno chcesz usunąć szablon ",e.jsxs("strong",{children:['"',o==null?void 0:o.name,'"']}),"?"]})}),e.jsxs(I,{sx:{px:{xs:2,sm:3},pb:{xs:2,sm:3}},children:[e.jsx(x,{onClick:()=>p(!1),size:l?"small":"medium",children:"Anuluj"}),e.jsx(x,{onClick:H,color:"error",variant:"contained",size:l?"small":"medium",children:"Usuń"})]})]})]})}export{Se as default};
