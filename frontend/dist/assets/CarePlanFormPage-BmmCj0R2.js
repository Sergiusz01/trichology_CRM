import{N as F,p as M,n as Z,o as G,r as c,q as C,j as e,B as f,C as S,T as W,P as L,I as U}from"./index-DuGlS2hS.js";import{A}from"./Alert-BnPrPNDn.js";import{G as r}from"./Grid-9JmJah-6.js";import{T as o}from"./TextField-VtT5fMIl.js";import{B as k}from"./Button-DYA-l7Ix.js";import{A as _}from"./Add-CyAZE82m.js";import{C as O}from"./Card-BZPW2CFi.js";import{C as Q}from"./CardContent-DyGdFslf.js";import{D as H}from"./Delete-XwNcIwF-.js";import"./useThemeProps-CESs6Os5.js";import"./Select-DgRGz9X7.js";function re(){const{id:j,carePlanId:d}=F(),w=M(),B=Z(),p=G(B.breakpoints.down("sm")),[y,z]=c.useState(!1),[R,P]=c.useState(!1),[D,x]=c.useState(""),[T,I]=c.useState(!1),[l,g]=c.useState({patientId:j||"",consultationId:"",title:"",totalDurationWeeks:4,notes:"",isActive:!0}),[u,h]=c.useState([]);c.useEffect(()=>{d?N():b(4)},[d]),c.useEffect(()=>{l.totalDurationWeeks>0&&b(l.totalDurationWeeks)},[l.totalDurationWeeks]);const b=s=>{const a=Array.from({length:s},(i,t)=>({weekNumber:t+1,description:"",washingRoutine:"",topicalProducts:"",supplements:"",inClinicProcedures:"",remarks:""}));h(a)},N=async()=>{var s,a;if(d)try{P(!0);const t=(await C.get(`/care-plans/${d}`)).data.carePlan;g({patientId:t.patientId||j||"",consultationId:t.consultationId||"",title:t.title||"",totalDurationWeeks:t.totalDurationWeeks||4,notes:t.notes||"",isActive:t.isActive!==void 0?t.isActive:!0}),t.weeks&&t.weeks.length>0?h(t.weeks.map(n=>({weekNumber:n.weekNumber,description:n.description||"",washingRoutine:n.washingRoutine||"",topicalProducts:n.topicalProducts||"",supplements:n.supplements||"",inClinicProcedures:n.inClinicProcedures||"",remarks:n.remarks||""}))):b(t.totalDurationWeeks||4)}catch(i){console.error("Błąd pobierania planu:",i),x(((a=(s=i.response)==null?void 0:s.data)==null?void 0:a.error)||"Błąd pobierania planu")}finally{P(!1)}},v=(s,a)=>{g(i=>({...i,[s]:a}))},m=(s,a,i)=>{const t=[...u];t[s]={...t[s],[a]:i},h(t)},E=()=>{h([...u,{weekNumber:u.length+1,description:"",washingRoutine:"",topicalProducts:"",supplements:"",inClinicProcedures:"",remarks:""}]),g(s=>({...s,totalDurationWeeks:s.totalDurationWeeks+1}))},$=s=>{if(u.length<=1){x("Musi być co najmniej jeden tydzień");return}const i=u.filter((t,n)=>n!==s).map((t,n)=>({...t,weekNumber:n+1}));h(i),g(t=>({...t,totalDurationWeeks:t.totalDurationWeeks-1}))},q=async s=>{var a,i;s.preventDefault(),z(!0),x(""),I(!1);try{const t={...l,consultationId:l.consultationId&&l.consultationId.trim()!==""?l.consultationId:void 0,weeks:u.filter(n=>n.description||n.washingRoutine||n.topicalProducts||n.supplements||n.inClinicProcedures||n.remarks)};d?await C.put(`/care-plans/${d}`,t):await C.post("/care-plans",t),I(!0),setTimeout(()=>{w(`/patients/${j}`)},1500)}catch(t){console.error("Błąd zapisywania planu:",t),x(((i=(a=t.response)==null?void 0:a.data)==null?void 0:i.error)||t.message||"Błąd zapisywania planu")}finally{z(!1)}};return R?e.jsx(f,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(S,{})}):e.jsxs(f,{sx:{width:"100%",maxWidth:"100%",overflow:"hidden",px:{xs:0,sm:0}},children:[e.jsx(W,{variant:"h4",gutterBottom:!0,sx:{fontSize:{xs:"1.5rem",sm:"2rem"},mb:{xs:2,sm:3},px:{xs:1.5,sm:0}},children:d?"Edytuj plan opieki":"Nowy plan opieki"}),D&&e.jsx(A,{severity:"error",sx:{mb:2},onClose:()=>x(""),children:D}),T&&e.jsx(A,{severity:"success",sx:{mb:2},children:"Plan opieki zapisany pomyślnie!"}),e.jsx(L,{sx:{p:{xs:1.5,sm:2,md:3},mb:{xs:1.5,sm:2}},children:e.jsx("form",{onSubmit:q,children:e.jsxs(r,{container:!0,spacing:{xs:1.5,sm:2,md:3},children:[e.jsx(r,{size:{xs:12},children:e.jsx(o,{fullWidth:!0,label:"Tytuł planu",value:l.title,onChange:s=>v("title",s.target.value),required:!0})}),e.jsx(r,{size:{xs:12,sm:6},children:e.jsx(o,{fullWidth:!0,label:"Czas trwania (tygodnie)",type:"number",value:l.totalDurationWeeks,onChange:s=>v("totalDurationWeeks",parseInt(s.target.value)||1),inputProps:{min:1},required:!0})}),e.jsx(r,{size:{xs:12},children:e.jsx(o,{fullWidth:!0,label:"Uwagi ogólne",value:l.notes,onChange:s=>v("notes",s.target.value),multiline:!0,rows:4})}),e.jsxs(r,{size:{xs:12},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(W,{variant:"h6",children:"Tygodnie planu"}),e.jsx(k,{variant:"outlined",size:"small",startIcon:e.jsx(_,{}),onClick:E,children:"Dodaj tydzień"})]}),u.map((s,a)=>e.jsx(O,{sx:{mb:2},children:e.jsxs(Q,{children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(W,{variant:"h6",children:["Tydzień ",s.weekNumber]}),u.length>1&&e.jsx(U,{size:"small",color:"error",onClick:()=>$(a),children:e.jsx(H,{})})]}),e.jsxs(r,{container:!0,spacing:{xs:1.5,sm:2},children:[e.jsx(r,{size:{xs:12},children:e.jsx(o,{fullWidth:!0,label:"Opis",value:s.description,onChange:i=>m(a,"description",i.target.value),multiline:!0,rows:2})}),e.jsx(r,{size:{xs:12,sm:6},children:e.jsx(o,{fullWidth:!0,label:"Rutyna mycia",value:s.washingRoutine,onChange:i=>m(a,"washingRoutine",i.target.value),multiline:!0,rows:2})}),e.jsx(r,{size:{xs:12,sm:6},children:e.jsx(o,{fullWidth:!0,label:"Produkty miejscowe",value:s.topicalProducts,onChange:i=>m(a,"topicalProducts",i.target.value),multiline:!0,rows:2})}),e.jsx(r,{size:{xs:12,sm:6},children:e.jsx(o,{fullWidth:!0,label:"Suplementacja",value:s.supplements,onChange:i=>m(a,"supplements",i.target.value),multiline:!0,rows:2})}),e.jsx(r,{size:{xs:12,sm:6},children:e.jsx(o,{fullWidth:!0,label:"Zabiegi w klinice",value:s.inClinicProcedures,onChange:i=>m(a,"inClinicProcedures",i.target.value),multiline:!0,rows:2})}),e.jsx(r,{size:{xs:12},children:e.jsx(o,{fullWidth:!0,label:"Uwagi",value:s.remarks,onChange:i=>m(a,"remarks",i.target.value),multiline:!0,rows:2})})]})]})},a))]}),e.jsx(r,{size:{xs:12},children:e.jsxs(f,{sx:{display:"flex",gap:{xs:1,sm:2},justifyContent:"flex-end",flexDirection:{xs:"column-reverse",sm:"row"},mt:{xs:1.5,sm:2}},children:[e.jsx(k,{variant:"outlined",onClick:()=>w(`/patients/${j}`),disabled:y,fullWidth:p,size:p?"medium":"large",sx:{fontSize:{xs:"0.875rem",sm:"1rem"},py:{xs:1.25,sm:1.5}},children:"Anuluj"}),e.jsx(k,{type:"submit",variant:"contained",disabled:y,fullWidth:p,size:p?"medium":"large",sx:{fontSize:{xs:"0.875rem",sm:"1rem"},py:{xs:1.25,sm:1.5}},children:y?e.jsx(S,{size:24}):p?"Zapisz":"Zapisz plan"})]})})]})})})]})}export{re as default};
