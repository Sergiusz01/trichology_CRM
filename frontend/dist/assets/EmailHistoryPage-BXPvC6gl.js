import{N as k,r as n,q as L,j as t,B as x,T as r,P as A,C as R,I}from"./index-DuGlS2hS.js";import{T as N,a as W,b as H,c as o,d as a,e as O}from"./TableRow-B0Vjdlj8.js";import{C as l}from"./Chip-CKQ1KLG2.js";import{C as Z}from"./CheckCircle-Cw3GtUAD.js";import{E as F}from"./Error-CqfdIaVc.js";import{V}from"./Visibility-zS0Eo4-i.js";import{T as $}from"./TablePagination-CyCLUKXI.js";import{D as M,a as q,b as K,c as _}from"./DialogTitle-Cnb6c1S1.js";import{D as G}from"./KeyboardArrowRight-CcXDP3W7.js";import{A as J}from"./Alert-BnPrPNDn.js";import{B as Q}from"./Button-DYA-l7Ix.js";import"./Select-DgRGz9X7.js";import"./MenuItem-0hJOb36H.js";function dt(){const{id:c}=k(),[m,P]=n.useState([]),[f,g]=n.useState(!0),[d,j]=n.useState(0),[h,C]=n.useState(10),[w,B]=n.useState(0),[s,S]=n.useState(null),[T,u]=n.useState(!1);n.useEffect(()=>{v()},[c,d,h]);const v=async()=>{var e;try{g(!0);const i=c?`/email/history/patient/${c}`:"/email/history",y=await L.get(i,{params:{page:d+1,limit:h}});P(y.data.emails||[]),B(((e=y.data.pagination)==null?void 0:e.total)||0)}catch(i){console.error("Błąd pobierania historii emaili:",i)}finally{g(!1)}},E=e=>{S(e),u(!0)},D=(e,i)=>{j(i)},z=e=>{C(parseInt(e.target.value,10)),j(0)},p=e=>{switch(e){case"SENT":return"success";case"FAILED":return"error";default:return"default"}},b=e=>{switch(e){case"SENT":return"Wysłany";case"FAILED":return"Błąd";default:return e}};return t.jsxs(x,{children:[t.jsx(r,{variant:"h4",gutterBottom:!0,children:"Historia wysłanych emaili"}),t.jsxs(N,{component:A,children:[t.jsxs(W,{children:[t.jsx(H,{children:t.jsxs(o,{children:[t.jsx(a,{children:"Data wysłania"}),t.jsx(a,{children:"Odbiorca"}),t.jsx(a,{children:"Temat"}),t.jsx(a,{children:"Załączniki"}),t.jsx(a,{children:"Status"}),t.jsx(a,{children:"Wysłał"}),t.jsx(a,{align:"right",children:"Akcje"})]})}),t.jsx(O,{children:f?t.jsx(o,{children:t.jsx(a,{colSpan:7,align:"center",sx:{py:4},children:t.jsx(R,{size:32})})}):m.length===0?t.jsx(o,{children:t.jsx(a,{colSpan:7,align:"center",children:"Brak wysłanych emaili"})}):m.map(e=>t.jsxs(o,{hover:!0,children:[t.jsx(a,{children:new Date(e.sentAt).toLocaleString("pl-PL")}),t.jsx(a,{children:e.recipientEmail}),t.jsx(a,{children:e.subject}),t.jsx(a,{children:e.attachmentCount>0?t.jsx(l,{label:`${e.attachmentCount} załącznik${e.attachmentCount>1?"i":""}`,size:"small",variant:"outlined"}):"-"}),t.jsx(a,{children:t.jsx(l,{label:b(e.status),color:p(e.status),size:"small",icon:e.status==="SENT"?t.jsx(Z,{}):t.jsx(F,{})})}),t.jsx(a,{children:e.sentBy.name}),t.jsx(a,{align:"right",children:t.jsx(I,{size:"small",onClick:()=>E(e),title:"Zobacz szczegóły",children:t.jsx(V,{})})})]},e.id))})]}),t.jsx($,{component:"div",count:w,page:d,onPageChange:D,rowsPerPage:h,onRowsPerPageChange:z,rowsPerPageOptions:[10,25,50],labelRowsPerPage:"Wierszy na stronę:"})]}),t.jsxs(M,{open:T,onClose:()=>u(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(q,{children:"Szczegóły emaila"}),t.jsx(K,{children:s&&t.jsxs(t.Fragment,{children:[t.jsxs(G,{children:[t.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:[t.jsx("strong",{children:"Data wysłania:"})," ",new Date(s.sentAt).toLocaleString("pl-PL")]}),t.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:[t.jsx("strong",{children:"Odbiorca:"})," ",s.recipientEmail]}),t.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:[t.jsx("strong",{children:"Temat:"})," ",s.subject]}),t.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:[t.jsx("strong",{children:"Wysłał:"})," ",s.sentBy.name]}),t.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:[t.jsx("strong",{children:"Status:"})," ",t.jsx(l,{label:b(s.status),color:p(s.status),size:"small"})]}),s.consultation&&t.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:[t.jsx("strong",{children:"Konsultacja:"})," ",new Date(s.consultation.consultationDate).toLocaleDateString("pl-PL")]}),s.carePlan&&t.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:[t.jsx("strong",{children:"Plan opieki:"})," ",s.carePlan.title]}),s.attachmentNames.length>0&&t.jsxs(x,{sx:{mt:2},children:[t.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:t.jsxs("strong",{children:["Załączniki (",s.attachmentCount,"):"]})}),s.attachmentNames.map((e,i)=>t.jsx(l,{label:e,size:"small",variant:"outlined",sx:{mr:1,mb:1}},i))]}),s.errorMessage&&t.jsxs(J,{severity:"error",sx:{mt:2},children:[t.jsx("strong",{children:"Błąd:"})," ",s.errorMessage]})]}),t.jsxs(x,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[t.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:t.jsx("strong",{children:"Treść wiadomości:"})}),t.jsx(r,{variant:"body2",sx:{whiteSpace:"pre-wrap",maxHeight:300,overflow:"auto"},children:s.message})]})]})}),t.jsx(_,{children:t.jsx(Q,{onClick:()=>u(!1),children:"Zamknij"})})]})]})}export{dt as default};
