import{N as I,r as x,p as L,n as S,o as A,q as w,j as s,B as n,C as v,T as e,P as T}from"./index-DuGlS2hS.js";import{u as N}from"./useNotification-DEJT79vM.js";import{C as f}from"./Container-DggLIBHC.js";import{A as F}from"./Alert-BnPrPNDn.js";import{B as m}from"./Button-DYA-l7Ix.js";import{A as D}from"./ArrowBack-BLijn9hB.js";import{G as O}from"./GetApp-BdLPp6v8.js";import{E as U}from"./Edit-CC4dElt7.js";import{C as $}from"./Card-BZPW2CFi.js";import{C as M}from"./CardContent-DyGdFslf.js";import"./useThemeProps-CESs6Os5.js";const G=h=>new Date(h).toLocaleString("pl-PL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});function es(){const{id:h,carePlanId:l}=I(),[t,W]=x.useState(null),[k,p]=x.useState(!0),[g,b]=x.useState(null),[u,y]=x.useState(!1),j=L(),B=S(),P=A(B.breakpoints.down("sm")),{error:C,success:E}=N();x.useEffect(()=>{l?R():(b("Brak ID planu opieki"),p(!1))},[l]);const R=async()=>{var r,d;try{p(!0),b(null);const i=await w.get(`/care-plans/${l}`);W(i.data.carePlan||i.data)}catch(i){console.error("Błąd pobierania planu:",i);const a=((d=(r=i.response)==null?void 0:r.data)==null?void 0:d.error)||"Błąd pobierania planu opieki";b(a),C(a)}finally{p(!1)}},z=async()=>{var r,d;try{y(!0);const i=await w.get(`/care-plans/${l}/pdf`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([i.data])),c=document.createElement("a");c.href=a,c.setAttribute("download",`plan-opieki-${l}.pdf`),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(a),E("PDF pobrany pomyślnie")}catch(i){console.error("Błąd pobierania PDF:",i);const a=((d=(r=i.response)==null?void 0:r.data)==null?void 0:d.error)||"Błąd pobierania PDF";C(a)}finally{y(!1)}};if(k)return s.jsx(f,{maxWidth:"lg",children:s.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,gap:2},children:[s.jsx(v,{size:48}),s.jsx(e,{variant:"body1",color:"text.secondary",children:"Ładowanie planu opieki..."})]})});if(g||!t)return s.jsx(f,{maxWidth:"lg",children:s.jsxs(n,{sx:{py:4},children:[s.jsx(F,{severity:"error",sx:{mb:2},children:g||"Plan opieki nie znaleziony"}),s.jsx(m,{onClick:()=>j(-1),startIcon:s.jsx(D,{}),children:"Powrót"})]})});const o=t.patient||{};return s.jsxs(f,{maxWidth:"lg",sx:{py:{xs:2,sm:3},px:{xs:1,sm:2,md:3}},children:[s.jsxs(n,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:{xs:2,sm:3},gap:{xs:1.5,sm:2}},children:[s.jsx(m,{startIcon:s.jsx(D,{}),onClick:()=>j(-1),size:P?"small":"medium",sx:{mb:{xs:0,sm:2}},children:"Powrót"}),s.jsxs(n,{sx:{display:"flex",gap:{xs:1,sm:2},flexWrap:"wrap",width:{xs:"100%",sm:"auto"}},children:[s.jsx(m,{variant:"outlined",startIcon:u?s.jsx(v,{size:20}):s.jsx(O,{}),onClick:z,disabled:u,children:u?"Pobieranie...":"Pobierz PDF"}),s.jsx(m,{variant:"contained",startIcon:s.jsx(U,{}),onClick:()=>j(`/patients/${h||o.id}/care-plans/${l}/edit`),children:"Edytuj"})]})]}),s.jsxs(T,{sx:{p:{xs:2,sm:3,md:4},backgroundColor:"#fff",boxShadow:2},children:[s.jsxs(n,{sx:{textAlign:"center",borderBottom:"2px solid #333",mb:3,pb:2},children:[s.jsx(e,{variant:"h4",sx:{fontWeight:"bold",mb:1},children:"PLAN OPIEKI TRYCHOLOGICZNEJ"}),s.jsx(e,{variant:"h6",sx:{fontWeight:"bold",mb:1},children:t.title}),s.jsxs(e,{variant:"body1",children:["Czas trwania: ",s.jsxs("strong",{children:[t.totalDurationWeeks," tygodni"]})]})]}),s.jsxs(n,{sx:{mb:3,p:2,backgroundColor:"#f9f9f9",borderRadius:1},children:[s.jsx(e,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"Dane pacjenta"}),s.jsxs(n,{children:[s.jsxs(e,{variant:"h6",sx:{fontWeight:"bold",mb:1},children:[o.firstName," ",o.lastName]}),o.phone&&s.jsxs(e,{children:[s.jsx("strong",{children:"Telefon:"})," ",o.phone]}),o.email&&s.jsxs(e,{children:[s.jsx("strong",{children:"Email:"})," ",o.email]})]})]}),t.notes&&s.jsxs(n,{sx:{mb:3,p:2,backgroundColor:"#fff3cd",borderLeft:"4px solid #ffc107",borderRadius:1},children:[s.jsx(e,{variant:"h6",sx:{fontWeight:"bold",mb:1},children:"Uwagi ogólne"}),s.jsx(e,{children:t.notes})]}),t.weeks&&t.weeks.length>0&&s.jsx(n,{sx:{mt:3},children:t.weeks.map(r=>s.jsx($,{sx:{mb:3,border:"1px solid #ddd",borderRadius:1},children:s.jsxs(M,{children:[s.jsxs(e,{variant:"h5",sx:{fontSize:"1.5rem",fontWeight:"bold",mb:2,color:"#2c3e50",borderBottom:"2px solid #3498db",pb:1},children:["Tydzień ",r.weekNumber]}),s.jsxs(n,{sx:{ml:1},children:[r.description&&s.jsxs(n,{sx:{mb:2},children:[s.jsx(e,{variant:"subtitle2",sx:{fontWeight:"bold",mb:.5,color:"#555"},children:"Opis:"}),s.jsx(e,{sx:{ml:2},children:r.description})]}),r.washingRoutine&&s.jsxs(n,{sx:{mb:2},children:[s.jsx(e,{variant:"subtitle2",sx:{fontWeight:"bold",mb:.5,color:"#555"},children:"Rutyna mycia:"}),s.jsx(e,{sx:{ml:2},children:r.washingRoutine})]}),r.topicalProducts&&s.jsxs(n,{sx:{mb:2},children:[s.jsx(e,{variant:"subtitle2",sx:{fontWeight:"bold",mb:.5,color:"#555"},children:"Produkty miejscowe:"}),s.jsx(e,{sx:{ml:2},children:r.topicalProducts})]}),r.supplements&&s.jsxs(n,{sx:{mb:2},children:[s.jsx(e,{variant:"subtitle2",sx:{fontWeight:"bold",mb:.5,color:"#555"},children:"Suplementacja:"}),s.jsx(e,{sx:{ml:2},children:r.supplements})]}),r.inClinicProcedures&&s.jsxs(n,{sx:{mb:2},children:[s.jsx(e,{variant:"subtitle2",sx:{fontWeight:"bold",mb:.5,color:"#555"},children:"Zabiegi w klinice:"}),s.jsx(e,{sx:{ml:2},children:r.inClinicProcedures})]}),r.remarks&&s.jsxs(n,{sx:{mb:2},children:[s.jsx(e,{variant:"subtitle2",sx:{fontWeight:"bold",mb:.5,color:"#555"},children:"Uwagi:"}),s.jsx(e,{sx:{ml:2},children:r.remarks})]})]})]})},r.id))}),s.jsxs(n,{sx:{mt:4,pt:2,borderTop:"1px solid #ddd",fontSize:"0.875rem",textAlign:"right",color:"#666"},children:[s.jsxs(e,{variant:"body2",children:["Wygenerowano: ",G(new Date)]}),t.createdBy&&s.jsxs(e,{variant:"body2",children:["Lekarz: ",t.createdBy.name]})]})]})]})}export{es as default};
