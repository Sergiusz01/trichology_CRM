import{O as Y,r as w,p as G,q as H,j as e,B as a,C as I,T as i,P as g}from"./index-ik9JjyS6.js";import{u as K}from"./useNotification-DgBW3D1z.js";import{C}from"./Container-U9Ph7Onl.js";import{A as J}from"./Alert-Dzq7_ew3.js";import{B as k}from"./Button-B6n5coYQ.js";import{A as U}from"./ArrowBack-CNB7SP5c.js";import{G as V}from"./GetApp-CjbL2B_C.js";import{E as q}from"./Edit-DimIYhJX.js";import{c as f,d as t,T as y,a as R,b as v,e as W}from"./TableRow-D3npZos0.js";import{C as E}from"./Chip-pTV9ioJu.js";import"./useThemeProps-C_QfMg4i.js";const Q=c=>c?new Date(c).toLocaleDateString("pl-PL",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",X=c=>new Date(c).toLocaleString("pl-PL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),O=c=>{if(!c)return"default";switch(c){case"LOW":case"HIGH":return"error";case"NORMAL":return"success";default:return"default"}},d=(c,x,r,u,p,j)=>x==null?null:e.jsxs(f,{children:[e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:e.jsx("strong",{children:c})}),e.jsxs(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:[x," ",r||""]}),e.jsxs(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},display:{xs:"none",md:"table-cell"}},children:[u??"-"," - ",p??"-"]}),e.jsx(t,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:e.jsx(E,{label:j||"-",color:O(j),size:"small",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"},height:{xs:20,sm:24}}})})]});function ce(){const{id:c,labResultId:x}=Y(),[r,u]=w.useState(null),[p,j]=w.useState(!0),[D,L]=w.useState(null),[B,S]=w.useState(!1),F=G(),{error:A,success:$}=K();w.useEffect(()=>{x?N():(L("Brak ID wyniku badania"),j(!1))},[x]);const N=async()=>{var h,m;try{j(!0),L(null);const o=await H.get(`/lab-results/${x}`);u(o.data.labResult||o.data)}catch(o){console.error("Błąd pobierania wyniku:",o);const l=((m=(h=o.response)==null?void 0:h.data)==null?void 0:m.error)||"Błąd pobierania wyniku badania";L(l),A(l)}finally{j(!1)}},M=async()=>{var h,m;try{S(!0);const o=await H.get(`/lab-results/${x}/pdf`,{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([o.data])),n=document.createElement("a");n.href=l,n.setAttribute("download",`wynik-badan-${x}.pdf`),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(l),$("PDF pobrany pomyślnie")}catch(o){console.error("Błąd pobierania PDF:",o);const l=((m=(h=o.response)==null?void 0:h.data)==null?void 0:m.error)||"Błąd pobierania PDF";A(l)}finally{S(!1)}};if(p)return e.jsx(C,{maxWidth:"lg",children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:8,gap:2},children:[e.jsx(I,{size:48}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Ładowanie wyniku badania..."})]})});if(D||!r)return e.jsx(C,{maxWidth:"lg",children:e.jsxs(a,{sx:{py:4},children:[e.jsx(J,{severity:"error",sx:{mb:2},children:D||"Wynik badania nie znaleziony"}),e.jsx(k,{onClick:()=>F(-1),startIcon:e.jsx(U,{}),children:"Powrót"})]})});const s=r.patient||{};return e.jsxs(C,{maxWidth:"lg",sx:{py:{xs:2,sm:3},px:{xs:1,sm:2,md:3}},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(k,{startIcon:e.jsx(U,{}),onClick:()=>F(-1),sx:{mb:2},children:"Powrót"}),e.jsxs(a,{sx:{display:"flex",gap:2},children:[e.jsx(k,{variant:"outlined",startIcon:B?e.jsx(I,{size:20}):e.jsx(V,{}),onClick:M,disabled:B,children:B?"Pobieranie...":"Pobierz PDF"}),e.jsx(k,{variant:"contained",startIcon:e.jsx(q,{}),onClick:()=>F(`/patients/${c||s.id}/lab-results/${x}/edit`),children:"Edytuj"})]})]}),e.jsxs(g,{sx:{p:{xs:2,sm:3,md:4},backgroundColor:"#fff",boxShadow:2},children:[e.jsxs(a,{sx:{textAlign:"center",borderBottom:"2px solid #333",mb:3,pb:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:"bold",mb:1},children:"WYNIK BADAŃ LABORATORYJNYCH"}),e.jsxs(i,{variant:"body1",children:["Data badania: ",e.jsx("strong",{children:Q(r.date)})]})]}),e.jsxs(a,{sx:{mb:3,p:2,backgroundColor:"#f9f9f9",borderRadius:1},children:[e.jsx(i,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"Dane pacjenta"}),e.jsxs(a,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:1},children:[e.jsxs(a,{children:[e.jsxs(i,{children:[e.jsx("strong",{children:"Pacjent:"})," ",s.firstName," ",s.lastName]}),s.age&&e.jsxs(i,{children:[e.jsx("strong",{children:"Wiek:"})," ",s.age," lat"]}),s.gender&&e.jsxs(i,{children:[e.jsx("strong",{children:"Płeć:"})," ",s.gender==="MALE"?"Mężczyzna":s.gender==="FEMALE"?"Kobieta":"Inna"]})]}),e.jsxs(a,{children:[s.phone&&e.jsxs(i,{children:[e.jsx("strong",{children:"Telefon:"})," ",s.phone]}),s.email&&e.jsxs(i,{children:[e.jsx("strong",{children:"Email:"})," ",s.email]})]})]})]}),e.jsxs(a,{sx:{mt:3},children:[r.templateId&&r.dynamicData&&r.template&&(()=>{const h=r.dynamicData,m=r.template,o=(m.fields||[]).slice().sort((n,b)=>(n.order??0)-(b.order??0)),l=[];return o.forEach(n=>{const b=h[n.key];if(!(b==null||b===""))if(n.type==="NUMBER"){const Z=h[`${n.key}Unit`]??n.unit??"",P=h[`${n.key}RefLow`]??n.refLow,z=h[`${n.key}RefHigh`]??n.refHigh,T=h[`${n.key}Flag`];l.push(e.jsxs(f,{children:[e.jsx(t,{children:e.jsx("strong",{children:n.label})}),e.jsxs(t,{children:[String(b)," ",Z]}),e.jsx(t,{sx:{display:{xs:"none",md:"table-cell"}},children:P!=null||z!=null?`${P??"-"} - ${z??"-"}`:"-"}),e.jsx(t,{children:e.jsx(E,{label:T||"-",color:O(T),size:"small",sx:{fontSize:"0.75rem"}})})]},n.key))}else l.push(e.jsxs(f,{children:[e.jsx(t,{children:e.jsx("strong",{children:n.label})}),e.jsx(t,{colSpan:3,children:String(b)})]},n.key))}),l.length===0?null:e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"h6",sx:{fontSize:"1.25rem",fontWeight:"bold",mt:3,mb:2,color:"#2c3e50",borderBottom:"2px solid #3498db",pb:1},children:["Wyniki (szablon: ",m.name||"—",")"]}),e.jsx(y,{component:g,sx:{mb:3},children:e.jsxs(R,{children:[e.jsx(v,{children:e.jsxs(f,{sx:{backgroundColor:"#2c3e50"},children:[e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Parametr"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Wartość"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold",display:{xs:"none",md:"table-cell"}},children:"Zakres referencyjny"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Status"})]})}),e.jsx(W,{children:l})]})})]})})(),!r.templateId&&(r.hgb!==null&&r.hgb!==void 0||r.rbc!==null&&r.rbc!==void 0||r.wbc!==null&&r.wbc!==void 0||r.plt!==null&&r.plt!==void 0)?e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h6",sx:{fontSize:"1.25rem",fontWeight:"bold",mt:3,mb:2,color:"#2c3e50",borderBottom:"2px solid #3498db",pb:1},children:"MORFOLOGIA KRWI"}),e.jsx(y,{component:g,sx:{mb:3},children:e.jsxs(R,{children:[e.jsx(v,{children:e.jsxs(f,{sx:{backgroundColor:"#2c3e50"},children:[e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Parametr"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Wartość"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Zakres referencyjny"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Status"})]})}),e.jsxs(W,{children:[d("Hemoglobina (HGB)",r.hgb,r.hgbUnit||"",r.hgbRefLow,r.hgbRefHigh,r.hgbFlag),d("Erytrocyty (RBC)",r.rbc,r.rbcUnit||"",r.rbcRefLow,r.rbcRefHigh,r.rbcFlag),d("Leukocyty (WBC)",r.wbc,r.wbcUnit||"",r.wbcRefLow,r.wbcRefHigh,r.wbcFlag),d("Płytki krwi (PLT)",r.plt,r.pltUnit||"",r.pltRefLow,r.pltRefHigh,r.pltFlag)]})]})})]}):null,!r.templateId&&(r.ferritin!==null&&r.ferritin!==void 0||r.iron!==null&&r.iron!==void 0)?e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h6",sx:{fontSize:"1.25rem",fontWeight:"bold",mt:3,mb:2,color:"#2c3e50",borderBottom:"2px solid #3498db",pb:1},children:"ŻELAZO"}),e.jsx(y,{component:g,sx:{mb:3},children:e.jsxs(R,{children:[e.jsx(v,{children:e.jsxs(f,{sx:{backgroundColor:"#2c3e50"},children:[e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Parametr"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Wartość"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Zakres referencyjny"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Status"})]})}),e.jsxs(W,{children:[d("Ferrytyna",r.ferritin,r.ferritinUnit||"",r.ferritinRefLow,r.ferritinRefHigh,r.ferritinFlag),d("Żelazo",r.iron,r.ironUnit||"",r.ironRefLow,r.ironRefHigh,r.ironFlag)]})]})})]}):null,!r.templateId&&(r.vitaminD3!==null&&r.vitaminD3!==void 0||r.vitaminB12!==null&&r.vitaminB12!==void 0||r.folicAcid!==null&&r.folicAcid!==void 0)?e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h6",sx:{fontSize:"1.25rem",fontWeight:"bold",mt:3,mb:2,color:"#2c3e50",borderBottom:"2px solid #3498db",pb:1},children:"WITAMINY"}),e.jsx(y,{component:g,sx:{mb:3},children:e.jsxs(R,{children:[e.jsx(v,{children:e.jsxs(f,{sx:{backgroundColor:"#2c3e50"},children:[e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Parametr"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Wartość"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Zakres referencyjny"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Status"})]})}),e.jsxs(W,{children:[d("Witamina D3",r.vitaminD3,r.vitaminD3Unit||"",r.vitaminD3RefLow,r.vitaminD3RefHigh,r.vitaminD3Flag),d("Witamina B12",r.vitaminB12,r.vitaminB12Unit||"",r.vitaminB12RefLow,r.vitaminB12RefHigh,r.vitaminB12Flag),d("Kwas foliowy",r.folicAcid,r.folicAcidUnit||"",r.folicAcidRefLow,r.folicAcidRefHigh,r.folicAcidFlag)]})]})})]}):null,!r.templateId&&(r.tsh!==null&&r.tsh!==void 0||r.ft3!==null&&r.ft3!==void 0||r.ft4!==null&&r.ft4!==void 0)?e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"h6",sx:{fontSize:"1.25rem",fontWeight:"bold",mt:3,mb:2,color:"#2c3e50",borderBottom:"2px solid #3498db",pb:1},children:"FUNKCJA TARCZYCY"}),e.jsx(y,{component:g,sx:{mb:3},children:e.jsxs(R,{children:[e.jsx(v,{children:e.jsxs(f,{sx:{backgroundColor:"#2c3e50"},children:[e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Parametr"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Wartość"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Zakres referencyjny"}),e.jsx(t,{sx:{color:"white",fontWeight:"bold"},children:"Status"})]})}),e.jsxs(W,{children:[d("TSH",r.tsh,r.tshUnit||"",r.tshRefLow,r.tshRefHigh,r.tshFlag),d("FT3",r.ft3,r.ft3Unit||"",r.ft3RefLow,r.ft3RefHigh,r.ft3Flag),d("FT4",r.ft4,r.ft4Unit||"",r.ft4RefLow,r.ft4RefHigh,r.ft4Flag)]})]})})]}):null]}),r.notes&&e.jsxs(a,{sx:{mt:3,p:2,backgroundColor:"#fff3cd",borderLeft:"4px solid #ffc107",borderRadius:1},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:"bold",mb:1},children:"Uwagi"}),e.jsx(i,{children:r.notes})]}),e.jsx(a,{sx:{mt:4,pt:2,borderTop:"1px solid #ddd",fontSize:"0.875rem",textAlign:"right",color:"#666"},children:e.jsxs(i,{variant:"body2",children:["Wygenerowano: ",X(new Date)]})})]})]})}export{ce as default};
