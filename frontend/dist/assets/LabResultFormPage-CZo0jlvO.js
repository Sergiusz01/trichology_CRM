import{c as M,j as e,D as w,T as g,O as ne,p as ae,n as re,o as oe,r as p,q as U,B as L,C as J,S as le,P as O}from"./index-ik9JjyS6.js";import{G as i}from"./Grid-OOY2WAvo.js";import{T as x,F as Y,I as _}from"./TextField-BNTsiTHM.js";import{S as ee}from"./Select--zggdXop.js";import{M as V}from"./MenuItem-cD7WzH5Q.js";import{A as q}from"./Alert-Dzq7_ew3.js";import{I as ce}from"./InputAdornment-D5dmfE1O.js";import{A,a as C,E as F,b as T}from"./ExpandMore-8R1eU3QT.js";import{A as Q}from"./Assignment-kAkaYihh.js";import{B as X}from"./Button-B6n5coYQ.js";import{C as de}from"./Cancel-CjIxMi8f.js";import{S as he}from"./Save-BBUZJYPl.js";import"./useThemeProps-C_QfMg4i.js";const fe=M(e.jsx("path",{d:"M12 2c-5.33 4.55-8 8.48-8 11.8 0 4.98 3.8 8.2 8 8.2s8-3.22 8-8.2c0-3.32-2.67-7.25-8-11.8m3 16H9v-2h6zm0-5h-2v2h-2v-2H9v-2h2V9h2v2h2z"})),xe=M(e.jsx("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V10h14zM9 14H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2zm-8 4H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2z"})),me=M([e.jsx("path",{d:"M15.11 12.45 14 10.24l-3.11 6.21c-.16.34-.51.55-.89.55s-.73-.21-.89-.55L7.38 13H2v5c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-5h-6c-.38 0-.73-.21-.89-.55"},"0"),e.jsx("path",{d:"M20 4H4c-1.1 0-2 .9-2 2v5h6c.38 0 .73.21.89.55L10 13.76l3.11-6.21c.34-.68 1.45-.68 1.79 0L16.62 11H22V6c0-1.1-.9-2-2-2"},"1")]),ue=M(e.jsx("path",{d:"M17.66 8 12 2.35 6.34 8C4.78 9.56 4 11.64 4 13.64s.78 4.11 2.34 5.67 3.61 2.35 5.66 2.35 4.1-.79 5.66-2.35S20 15.64 20 13.64 19.22 9.56 17.66 8M6 14c.01-2 .62-3.27 1.76-4.4L12 5.27l4.24 4.38C17.38 10.77 17.99 12 18 14z"}));function pe({fields:b,formData:a,onChange:j}){const E=[...b].sort((s,d)=>(s.order??0)-(d.order??0)),W=s=>{const d=a[s.key],v=`${s.key}Unit`,I=`${s.key}RefLow`,S=`${s.key}RefHigh`;if(s.type==="NUMBER"){const u=a[v]??s.unit??"",R=a[I],k=a[S];return e.jsxs(i,{container:!0,spacing:2,size:{xs:12},alignItems:"center",sx:{width:"100%"},children:[e.jsx(i,{size:{xs:12,md:3},children:e.jsx(g,{variant:"subtitle1",fontWeight:600,color:"text.secondary",children:s.label})}),e.jsx(i,{size:{xs:6,sm:4,md:3},children:e.jsx(x,{fullWidth:!0,label:"Wynik",type:"number",size:"small",value:d??"",onChange:l=>{const $=l.target.value===""?void 0:parseFloat(l.target.value);j(s.key,$)}})}),e.jsx(i,{size:{xs:6,sm:4,md:2},children:e.jsx(x,{fullWidth:!0,label:"Jedn.",size:"small",value:u,onChange:l=>j(v,l.target.value)})}),e.jsx(i,{size:{xs:6,sm:2,md:2},children:e.jsx(x,{fullWidth:!0,label:"Ref. dół",type:"number",size:"small",value:R??"",onChange:l=>j(I,l.target.value===""?void 0:parseFloat(l.target.value))})}),e.jsx(i,{size:{xs:6,sm:2,md:2},children:e.jsx(x,{fullWidth:!0,label:"Ref. góra",type:"number",size:"small",value:k??"",onChange:l=>j(S,l.target.value===""?void 0:parseFloat(l.target.value))})})]},s.key)}if(s.type==="SELECT"){const u=s.options??[];return e.jsx(i,{size:{xs:12},children:e.jsxs(Y,{fullWidth:!0,size:"small",sx:{maxWidth:400},children:[e.jsx(_,{children:s.label}),e.jsx(ee,{value:d??"",label:s.label,onChange:R=>j(s.key,R.target.value),children:u.map(R=>e.jsx(V,{value:R,children:R},R))})]})},s.key)}return e.jsx(i,{size:{xs:12},children:e.jsx(x,{fullWidth:!0,label:s.label,multiline:s.type==="TEXT"&&(s.label.toLowerCase().includes("notat")||s.key==="notes"),rows:s.key==="notes"?4:1,value:d??"",onChange:u=>j(s.key,u.target.value)})},s.key)};return e.jsx(i,{container:!0,spacing:2,children:E.map((s,d)=>e.jsxs(i,{size:{xs:12},children:[d>0&&e.jsx(w,{sx:{my:1,opacity:.6}}),W(s)]},s.key))})}function We(){var Z;const{id:b,labResultId:a}=ne(),j=ae(),E=re(),W=oe(E.breakpoints.down("sm")),[s,d]=p.useState(!1),[v,I]=p.useState(!1),[S,u]=p.useState(""),[R,k]=p.useState(!1),[l,$]=p.useState([]),[z,K]=p.useState(""),[P,B]=p.useState({}),[r,G]=p.useState({patientId:b||"",consultationId:"",date:new Date().toISOString().split("T")[0],hgb:"",hgbUnit:"g/dL",hgbRefLow:"",hgbRefHigh:"",rbc:"",rbcUnit:"M/μL",rbcRefLow:"",rbcRefHigh:"",wbc:"",wbcUnit:"K/μL",wbcRefLow:"",wbcRefHigh:"",plt:"",pltUnit:"K/μL",pltRefLow:"",pltRefHigh:"",ferritin:"",ferritinUnit:"ng/mL",ferritinRefLow:"",ferritinRefHigh:"",iron:"",ironUnit:"μg/dL",ironRefLow:"",ironRefHigh:"",vitaminD3:"",vitaminD3Unit:"ng/mL",vitaminD3RefLow:"",vitaminD3RefHigh:"",vitaminB12:"",vitaminB12Unit:"pg/mL",vitaminB12RefLow:"",vitaminB12RefHigh:"",folicAcid:"",folicAcidUnit:"ng/mL",folicAcidRefLow:"",folicAcidRefHigh:"",tsh:"",tshUnit:"mIU/L",tshRefLow:"",tshRefHigh:"",ft3:"",ft3Unit:"pg/mL",ft3RefLow:"",ft3RefHigh:"",ft4:"",ft4Unit:"ng/dL",ft4RefLow:"",ft4RefHigh:"",notes:""}),H=(n,o)=>{G(f=>({...f,[n]:o}))},te=(n,o)=>{B(f=>({...f,[n]:o}))},ie=async n=>{var o,f;n.preventDefault(),I(!0),u(""),k(!1);try{const m={patientId:r.patientId||b,date:r.date?new Date(r.date).toISOString():void 0,consultationId:r.consultationId||void 0,notes:r.notes||void 0};if(z&&l.some(c=>c.id===z)){const c={...P};c.notes=m.notes??P.notes??"";const N={...m,templateId:z,dynamicData:c};a?await U.put(`/lab-results/${a}`,N):await U.post("/lab-results",N)}else{const c=y=>y===""?void 0:parseFloat(y);["hgb","hgbRefLow","hgbRefHigh","rbc","rbcRefLow","rbcRefHigh","wbc","wbcRefLow","wbcRefHigh","plt","pltRefLow","pltRefHigh","ferritin","ferritinRefLow","ferritinRefHigh","iron","ironRefLow","ironRefHigh","vitaminD3","vitaminD3RefLow","vitaminD3RefHigh","vitaminB12","vitaminB12RefLow","vitaminB12RefHigh","folicAcid","folicAcidRefLow","folicAcidRefHigh","tsh","tshRefLow","tshRefHigh","ft3","ft3RefLow","ft3RefHigh","ft4","ft4RefLow","ft4RefHigh"].forEach(y=>{const D=c(r[y]);D!==void 0&&(m[y]=D)}),["hgbUnit","rbcUnit","wbcUnit","pltUnit","ferritinUnit","ironUnit","vitaminD3Unit","vitaminB12Unit","folicAcidUnit","tshUnit","ft3Unit","ft4Unit"].forEach(y=>{const D=r[y];D&&(m[y]=D)}),a?await U.put(`/lab-results/${a}`,m):await U.post("/lab-results",m)}k(!0),setTimeout(()=>j(`/patients/${b}`),1500)}catch(t){u(((f=(o=t.response)==null?void 0:o.data)==null?void 0:f.error)||t.message||"Błąd zapisywania wyniku")}finally{I(!1)}};p.useEffect(()=>{(async()=>{try{const n=await U.get("/lab-result-templates");$(n.data.templates||[])}catch{}})()},[]),p.useEffect(()=>{a&&b&&se()},[a,b]);const se=async()=>{var n,o;if(a)try{d(!0);const t=(await U.get(`/lab-results/${a}`)).data.labResult,m=t.date?new Date(t.date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0];G({patientId:t.patientId||b||"",consultationId:t.consultationId||"",date:m,hgb:t.hgb??"",hgbUnit:t.hgbUnit||"g/dL",hgbRefLow:t.hgbRefLow??"",hgbRefHigh:t.hgbRefHigh??"",rbc:t.rbc??"",rbcUnit:t.rbcUnit||"M/μL",rbcRefLow:t.rbcRefLow??"",rbcRefHigh:t.rbcRefHigh??"",wbc:t.wbc??"",wbcUnit:t.wbcUnit||"K/μL",wbcRefLow:t.wbcRefLow??"",wbcRefHigh:t.wbcRefHigh??"",plt:t.plt??"",pltUnit:t.pltUnit||"K/μL",pltRefLow:t.pltRefLow??"",pltRefHigh:t.pltRefHigh??"",ferritin:t.ferritin??"",ferritinUnit:t.ferritinUnit||"ng/mL",ferritinRefLow:t.ferritinRefLow??"",ferritinRefHigh:t.ferritinRefHigh??"",iron:t.iron??"",ironUnit:t.ironUnit||"μg/dL",ironRefLow:t.ironRefLow??"",ironRefHigh:t.ironRefHigh??"",vitaminD3:t.vitaminD3??"",vitaminD3Unit:t.vitaminD3Unit||"ng/mL",vitaminD3RefLow:t.vitaminD3RefLow??"",vitaminD3RefHigh:t.vitaminD3RefHigh??"",vitaminB12:t.vitaminB12??"",vitaminB12Unit:t.vitaminB12Unit||"pg/mL",vitaminB12RefLow:t.vitaminB12RefLow??"",vitaminB12RefHigh:t.vitaminB12RefHigh??"",folicAcid:t.folicAcid??"",folicAcidUnit:t.folicAcidUnit||"ng/mL",folicAcidRefLow:t.folicAcidRefLow??"",folicAcidRefHigh:t.folicAcidRefHigh??"",tsh:t.tsh??"",tshUnit:t.tshUnit||"mIU/L",tshRefLow:t.tshRefLow??"",tshRefHigh:t.tshRefHigh??"",ft3:t.ft3??"",ft3Unit:t.ft3Unit||"pg/mL",ft3RefLow:t.ft3RefLow??"",ft3RefHigh:t.ft3RefHigh??"",ft4:t.ft4??"",ft4Unit:t.ft4Unit||"ng/dL",ft4RefLow:t.ft4RefLow??"",ft4RefHigh:t.ft4RefHigh??"",notes:t.notes??""}),t.templateId&&t.dynamicData?(K(t.templateId),B(typeof t.dynamicData=="object"?t.dynamicData:{})):(K(""),B({}))}catch(f){u(((o=(n=f.response)==null?void 0:n.data)==null?void 0:o.error)||"Błąd pobierania wyniku")}finally{d(!1)}};if(s||v&&!r.patientId)return e.jsx(L,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(J,{})});return e.jsxs(L,{sx:{width:"100%",maxWidth:"100%",overflow:"hidden",px:{xs:0,sm:0}},children:[e.jsxs(g,{variant:"h4",gutterBottom:!0,sx:{fontSize:{xs:"1.75rem",sm:"2.25rem"},fontWeight:700,mb:4,color:"primary.main",display:"flex",alignItems:"center",gap:2},children:[e.jsx(le,{fontSize:"large"}),a?"Edytuj wynik badania":"Nowy wynik badania"]}),S&&e.jsx(q,{severity:"error",sx:{mb:3,borderRadius:2},onClose:()=>u(""),children:S}),R&&e.jsx(q,{severity:"success",sx:{mb:3,borderRadius:2},children:"Wynik zapisany pomyślnie!"}),e.jsxs("form",{onSubmit:ie,children:[e.jsx(O,{sx:{p:{xs:2,sm:3},mb:3,borderRadius:3,overflow:"hidden",elevation:2},children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{size:{xs:12,sm:6,md:4},children:e.jsx(x,{fullWidth:!0,label:"Data badania",type:"date",value:r.date,onChange:n=>H("date",n.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ce,{position:"start",children:e.jsx(xe,{color:"action"})})}})}),e.jsx(i,{size:{xs:12,sm:6,md:4},children:e.jsxs(Y,{fullWidth:!0,size:"medium",children:[e.jsx(_,{children:"Szablon wyników"}),e.jsxs(ee,{value:z,label:"Szablon wyników",onChange:n=>{K(n.target.value),n.target.value||B({})},children:[e.jsx(V,{value:"",children:"Bez szablonu (formularz standardowy)"}),l.map(n=>e.jsxs(V,{value:n.id,children:[n.name,n.isDefault?" (domyślny)":""]},n.id))]})]})})]})}),z?e.jsxs(O,{sx:{p:{xs:2,sm:3},mb:3,borderRadius:2,boxShadow:1},children:[e.jsx(g,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Wyniki (szablon)"}),e.jsx(pe,{fields:((Z=l.find(n=>n.id===z))==null?void 0:Z.fields)??[],formData:P,onChange:te}),e.jsx(g,{variant:"subtitle2",sx:{mt:2,mb:1},children:"Notatki"}),e.jsx(x,{fullWidth:!0,multiline:!0,rows:3,placeholder:"Dodatkowe uwagi...",value:r.notes,onChange:n=>H("notes",n.target.value)})]}):e.jsxs(L,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(A,{defaultExpanded:!0,sx:{borderRadius:2,"&:before":{display:"none"},boxShadow:1},children:[e.jsx(C,{expandIcon:e.jsx(F,{}),children:e.jsxs(L,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(fe,{color:"error"}),e.jsx(g,{variant:"h6",fontWeight:600,children:"Morfologia"})]})}),e.jsx(T,{sx:{p:{xs:2,sm:3}},children:e.jsxs(i,{container:!0,spacing:3,children:[h("HGB","hgb"),e.jsx(i,{size:{xs:12},children:e.jsx(w,{sx:{my:1,opacity:.6}})}),h("RBC","rbc"),e.jsx(i,{size:{xs:12},children:e.jsx(w,{sx:{my:1,opacity:.6}})}),h("WBC","wbc"),e.jsx(i,{size:{xs:12},children:e.jsx(w,{sx:{my:1,opacity:.6}})}),h("PLT","plt")]})})]}),e.jsxs(A,{sx:{borderRadius:2,"&:before":{display:"none"},boxShadow:1},children:[e.jsx(C,{expandIcon:e.jsx(F,{}),children:e.jsxs(L,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(ue,{color:"error"}),e.jsx(g,{variant:"h6",fontWeight:600,children:"Gospodarka żelazowa"})]})}),e.jsx(T,{sx:{p:{xs:2,sm:3}},children:e.jsxs(i,{container:!0,spacing:3,children:[h("Ferrytyna","ferritin"),e.jsx(i,{size:{xs:12},children:e.jsx(w,{sx:{my:1,opacity:.6}})}),h("Żelazo","iron")]})})]}),e.jsxs(A,{sx:{borderRadius:2,"&:before":{display:"none"},boxShadow:1},children:[e.jsx(C,{expandIcon:e.jsx(F,{}),children:e.jsxs(L,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(me,{color:"primary"}),e.jsx(g,{variant:"h6",fontWeight:600,children:"Witaminy"})]})}),e.jsx(T,{sx:{p:{xs:2,sm:3}},children:e.jsxs(i,{container:!0,spacing:3,children:[h("Witamina D3","vitaminD3"),e.jsx(i,{size:{xs:12},children:e.jsx(w,{sx:{my:1,opacity:.6}})}),h("Witamina B12","vitaminB12"),e.jsx(i,{size:{xs:12},children:e.jsx(w,{sx:{my:1,opacity:.6}})}),h("Kwas foliowy","folicAcid")]})})]}),e.jsxs(A,{sx:{borderRadius:2,"&:before":{display:"none"},boxShadow:1},children:[e.jsx(C,{expandIcon:e.jsx(F,{}),children:e.jsxs(L,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Q,{color:"info"}),e.jsx(g,{variant:"h6",fontWeight:600,children:"Tarczyca"})]})}),e.jsx(T,{sx:{p:{xs:2,sm:3}},children:e.jsxs(i,{container:!0,spacing:3,children:[h("TSH","tsh"),e.jsx(i,{size:{xs:12},children:e.jsx(w,{sx:{my:1,opacity:.6}})}),h("FT3","ft3"),e.jsx(i,{size:{xs:12},children:e.jsx(w,{sx:{my:1,opacity:.6}})}),h("FT4","ft4")]})})]}),e.jsxs(O,{sx:{p:{xs:2,sm:3},borderRadius:2,mt:1,boxShadow:1},children:[e.jsxs(g,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{fontSize:"small",color:"action"}),"Notatki i uwagi dodatkowe"]}),e.jsx(x,{fullWidth:!0,multiline:!0,rows:4,placeholder:"Wpisz wszelkie dodatkowe informacje o wynikach lub samopoczuciu pacjenta...",value:r.notes,onChange:n=>H("notes",n.target.value),sx:{mt:1}})]})]}),e.jsxs(L,{sx:{display:"flex",gap:2,mt:4,mb:4,flexDirection:{xs:"column-reverse",sm:"row"},justifyContent:"flex-end"},children:[e.jsx(X,{variant:"outlined",onClick:()=>j(`/patients/${b}`),fullWidth:W,disabled:v,startIcon:e.jsx(de,{}),sx:{px:4,py:1.5,borderRadius:2,fontWeight:600},children:"Anuluj"}),e.jsx(X,{type:"submit",variant:"contained",disabled:v,fullWidth:W,startIcon:v?e.jsx(J,{size:20,color:"inherit"}):e.jsx(he,{}),sx:{px:6,py:1.5,borderRadius:2,fontWeight:600,boxShadow:3},children:v?"Zapisywanie...":a?"Zaktualizuj wynik":"Zapisz wynik"})]})]})]});function h(n,o){const f=`${o}Unit`,t=`${o}RefLow`,m=`${o}RefHigh`;return e.jsxs(i,{container:!0,spacing:2,size:{xs:12},alignItems:"center",children:[e.jsx(i,{size:{xs:12,md:3},children:e.jsx(g,{variant:"subtitle1",fontWeight:600,color:"text.secondary",children:n})}),e.jsx(i,{size:{xs:6,sm:4,md:3},children:e.jsx(x,{fullWidth:!0,label:"Wynik",type:"number",size:"small",value:r[o],onChange:c=>H(o,c.target.value)})}),e.jsx(i,{size:{xs:6,sm:4,md:2},children:e.jsx(x,{fullWidth:!0,label:"Jedn.",size:"small",value:r[f],onChange:c=>H(f,c.target.value)})}),e.jsx(i,{size:{xs:6,sm:2,md:2},children:e.jsx(x,{fullWidth:!0,label:"Ref. dół",type:"number",size:"small",value:r[t],onChange:c=>H(t,c.target.value)})}),e.jsx(i,{size:{xs:6,sm:2,md:2},children:e.jsx(x,{fullWidth:!0,label:"Ref. góra",type:"number",size:"small",value:r[m],onChange:c=>H(m,c.target.value)})})]})}}export{We as default};
