import{r as b,V as Jt,J as nt,ai as Qt,g as qt,a as Zt,b as _t,j as n,s as _,e as st,f as at,h as Kt,m as $e,K as xt,P as jt,I as zt,O as Xt,p as eo,Q as to,q as rt,B as It,t as Dt,T as Mt,C as Rt}from"./index-ik9JjyS6.js";import{u as oo}from"./useNotification-DgBW3D1z.js";import{P as Yt,V as no}from"./visitStatus-D0tn9_2F.js";import{C as ro}from"./Container-U9Ph7Onl.js";import{A as so}from"./ArrowBack-CNB7SP5c.js";import{C as ao,A as Nt}from"./Alert-Dzq7_ew3.js";import{G}from"./Grid-OOY2WAvo.js";import{a as yt,A as io,c as Re,i as ve,o as Wt,d as St,S as Pt}from"./Select--zggdXop.js";import{C as lo}from"./Chip-pTV9ioJu.js";import{T as Oe,F as Ct,I as vt}from"./TextField-BNTsiTHM.js";import{M as Ot}from"./MenuItem-cD7WzH5Q.js";import{I as uo}from"./InputAdornment-D5dmfE1O.js";import{B as Ft}from"./Button-B6n5coYQ.js";import{S as po}from"./Save-BBUZJYPl.js";import"./useThemeProps-C_QfMg4i.js";function co(o){const s=b.useRef({});return b.useEffect(()=>{s.current=o}),s.current}function Et({array1:o,array2:s,parser:c=f=>f}){return o&&s&&o.length===s.length&&o.every((f,x)=>c(f)===c(s[x]))}function Vt(o){return o.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function fo(o={}){const{ignoreAccents:s=!0,ignoreCase:c=!0,limit:f,matchFrom:x="any",stringify:P,trim:I=!1}=o;return(O,{inputValue:H,getOptionLabel:W})=>{let $=I?H.trim():H;c&&($=$.toLowerCase()),s&&($=Vt($));const A=$?O.filter(pe=>{let R=(P||W)(pe);return c&&(R=R.toLowerCase()),s&&(R=Vt(R)),x==="start"?R.startsWith($):R.includes($)}):O;return typeof f=="number"?A.slice(0,f):A}}const go=fo(),Ht=5,ho=o=>{var s;return o.current!==null&&((s=o.current.parentElement)==null?void 0:s.contains(document.activeElement))},mo=[];function Ut(o,s,c,f){if(s||o==null||f)return"";const x=c(o);return typeof x=="string"?x:""}function bo(o){const{unstable_isActiveElementInListbox:s=ho,unstable_classNamePrefix:c="Mui",autoComplete:f=!1,autoHighlight:x=!1,autoSelect:P=!1,blurOnSelect:I=!1,clearOnBlur:O=!o.freeSolo,clearOnEscape:H=!1,componentName:W="useAutocomplete",defaultValue:$=o.multiple?mo:null,disableClearable:A=!1,disableCloseOnSelect:pe=!1,disabled:R,disabledItemsFocusable:me=!1,disableListWrap:Ae=!1,filterOptions:oe=go,filterSelectedOptions:ne=!1,freeSolo:T=!1,getOptionDisabled:F,getOptionKey:g,getOptionLabel:be=t=>t.label??t,groupBy:re,handleHomeEndKeys:Ne=!o.freeSolo,id:U,includeInputInList:xe=!1,inputValue:je,isOptionEqualToValue:a=(t,e)=>t===e,multiple:u=!1,onChange:E,onClose:K,onHighlightChange:q,onInputChange:C,onOpen:y,open:Ie,openOnFocus:qe=!1,options:Ze,readOnly:Y=!1,renderValue:D,selectOnFocus:ze=!o.freeSolo,value:we}=o,B=Jt(U);let z=be;z=t=>{const e=be(t);return typeof e!="string"?String(e):e};const We=b.useRef(!1),Fe=b.useRef(!0),w=b.useRef(null),Z=b.useRef(null),[Ee,wt]=b.useState(null),[V,ye]=b.useState(-1),it=x?0:-1,M=b.useRef(it),Lt=b.useRef(Ut($??we,u,z)).current,[i,lt]=yt({controlled:we,default:$,name:W}),[m,se]=yt({controlled:je,default:Lt,name:W,state:"inputValue"}),[Le,_e]=b.useState(!1),ke=b.useCallback((t,e,r)=>{if(!(u?i.length<e.length:e!==null)&&!O)return;const p=Ut(e,u,z,D);m!==p&&(se(p),C&&C(t,p,r))},[z,m,u,C,se,O,i,D]),[ae,Se]=yt({controlled:Ie,default:!1,name:W,state:"open"}),[kt,Te]=b.useState(!0),Ke=!u&&i!=null&&m===z(i),N=ae&&!Y,S=N?oe(Ze.filter(t=>!(ne&&(u?i:[i]).some(e=>e!==null&&a(t,e)))),{inputValue:Ke&&kt?"":m,getOptionLabel:z}):[],J=co({filteredOptions:S,value:i,inputValue:m});b.useEffect(()=>{const t=i!==J.value;Le&&!t||T&&!t||ke(null,i,"reset")},[i,ke,Le,J.value,T]);const Ye=ae&&S.length>0&&!Y,te=nt(t=>{if(t===-1)w.current.focus();else{const e=D?"data-item-index":"data-tag-index";Ee.querySelector(`[${e}="${t}"]`).focus()}});b.useEffect(()=>{u&&V>i.length-1&&(ye(-1),te(-1))},[i,u,V,te]);function ut(t,e){if(!Z.current||t<0||t>=S.length)return-1;let r=t;for(;;){const l=Z.current.querySelector(`[data-option-index="${r}"]`),p=me?!1:!l||l.disabled||l.getAttribute("aria-disabled")==="true";if(l&&l.hasAttribute("tabindex")&&!p)return r;if(e==="next"?r=(r+1)%S.length:r=(r-1+S.length)%S.length,r===t)return-1}}const ie=nt(({event:t,index:e,reason:r})=>{if(M.current=e,e===-1?w.current.removeAttribute("aria-activedescendant"):w.current.setAttribute("aria-activedescendant",`${B}-option-${e}`),q&&["mouse","keyboard","touch"].includes(r)&&q(t,e===-1?null:S[e],r),!Z.current)return;const l=Z.current.querySelector(`[role="option"].${c}-focused`);l&&(l.classList.remove(`${c}-focused`),l.classList.remove(`${c}-focusVisible`));let p=Z.current;if(Z.current.getAttribute("role")!=="listbox"&&(p=Z.current.parentElement.querySelector('[role="listbox"]')),!p)return;if(e===-1){p.scrollTop=0;return}const k=Z.current.querySelector(`[data-option-index="${e}"]`);if(k&&(k.classList.add(`${c}-focused`),r==="keyboard"&&k.classList.add(`${c}-focusVisible`),p.scrollHeight>p.clientHeight&&r!=="mouse"&&r!=="touch")){const v=k,ee=p.clientHeight+p.scrollTop,et=v.offsetTop+v.offsetHeight;et>ee?p.scrollTop=et-p.clientHeight:v.offsetTop-v.offsetHeight*(re?1.3:0)<p.scrollTop&&(p.scrollTop=v.offsetTop-v.offsetHeight*(re?1.3:0))}}),Q=nt(({event:t,diff:e,direction:r="next",reason:l})=>{if(!N)return;const k=ut((()=>{const v=S.length-1;if(e==="reset")return it;if(e==="start")return 0;if(e==="end")return v;const ee=M.current+e;return ee<0?ee===-1&&xe?-1:Ae&&M.current!==-1||Math.abs(e)>1?0:v:ee>v?ee===v+1&&xe?-1:Ae||Math.abs(e)>1?v:0:ee})(),r);if(ie({index:k,reason:l,event:t}),f&&e!=="reset")if(k===-1)w.current.value=m;else{const v=z(S[k]);w.current.value=v,v.toLowerCase().indexOf(m.toLowerCase())===0&&m.length>0&&w.current.setSelectionRange(m.length,v.length)}}),Je=!Et({array1:J.filteredOptions,array2:S,parser:z}),pt=()=>{const t=(e,r)=>{const l=e?z(e):"",p=r?z(r):"";return l===p};if(M.current!==-1&&!Et({array1:J.filteredOptions,array2:S,parser:z})&&J.inputValue===m&&(u?i.length===J.value.length&&J.value.every((e,r)=>z(i[r])===z(e)):t(J.value,i))){const e=J.filteredOptions[M.current];if(e)return S.findIndex(r=>z(r)===z(e))}return-1},Ve=b.useCallback(()=>{if(!N)return;const t=pt();if(t!==-1){M.current=t;return}const e=u?i[0]:i;if(S.length===0||e==null){Q({diff:"reset"});return}if(Z.current){if(e!=null){const r=S[M.current];if(u&&r&&i.findIndex(p=>a(r,p))!==-1)return;const l=S.findIndex(p=>a(p,e));l===-1?Q({diff:"reset"}):ie({index:l});return}if(M.current>=S.length-1){ie({index:S.length-1});return}ie({index:M.current})}},[S.length,u?!1:i,Q,ie,N,m,u]),ce=nt(t=>{Qt(Z,t),t&&Ve()});b.useEffect(()=>{(Je||N)&&Ve()},[Ve,Je,N]);const le=t=>{ae||(Se(!0),Te(!0),y&&y(t))},Pe=(t,e)=>{ae&&(Se(!1),K&&K(t,e))},X=(t,e,r,l)=>{if(u){if(i.length===e.length&&i.every((p,k)=>p===e[k]))return}else if(i===e)return;E&&E(t,e,r,l),lt(e)},ue=b.useRef(!1),de=(t,e,r="selectOption",l="options")=>{let p=r,k=e;if(u){k=Array.isArray(i)?i.slice():[];const v=k.findIndex(ee=>a(e,ee));v===-1?k.push(e):l!=="freeSolo"&&(k.splice(v,1),p="removeOption")}ke(t,k,p),X(t,k,p,{option:e}),!pe&&(!t||!t.ctrlKey&&!t.metaKey)&&Pe(t,p),(I===!0||I==="touch"&&ue.current||I==="mouse"&&!ue.current)&&w.current.blur()};function ct(t,e){if(t===-1)return-1;let r=t;for(;;){if(e==="next"&&r===i.length||e==="previous"&&r===-1)return-1;const l=D?"data-item-index":"data-tag-index",p=Ee.querySelector(`[${l}="${r}"]`);if(!p||!p.hasAttribute("tabindex")||p.disabled||p.getAttribute("aria-disabled")==="true")r+=e==="next"?1:-1;else return r}}const Ce=(t,e)=>{if(!u)return;m===""&&Pe(t,"toggleInput");let r=V;V===-1&&e==="previous"?(r=i.length-1,T&&m!==""&&(se(""),C&&C(t,"","reset"))):(r+=e==="next"?1:-1,r<0&&(r=0),r===i.length&&(r=-1)),r=ct(r,e),ye(r),te(r)},Qe=t=>{We.current=!0,se(""),C&&C(t,"","clear"),X(t,u?[]:null,"clear")},dt=t=>e=>{if(t.onKeyDown&&t.onKeyDown(e),!e.defaultMuiPrevented&&(V!==-1&&!["ArrowLeft","ArrowRight"].includes(e.key)&&(ye(-1),te(-1)),e.which!==229))switch(e.key){case"Home":N&&Ne&&(e.preventDefault(),Q({diff:"start",direction:"next",reason:"keyboard",event:e}));break;case"End":N&&Ne&&(e.preventDefault(),Q({diff:"end",direction:"previous",reason:"keyboard",event:e}));break;case"PageUp":e.preventDefault(),Q({diff:-Ht,direction:"previous",reason:"keyboard",event:e}),le(e);break;case"PageDown":e.preventDefault(),Q({diff:Ht,direction:"next",reason:"keyboard",event:e}),le(e);break;case"ArrowDown":e.preventDefault(),Q({diff:1,direction:"next",reason:"keyboard",event:e}),le(e);break;case"ArrowUp":e.preventDefault(),Q({diff:-1,direction:"previous",reason:"keyboard",event:e}),le(e);break;case"ArrowLeft":{const r=w.current;if(!(r&&r.selectionStart===0&&r.selectionEnd===0))return;!u&&D&&i!=null?(T&&m!==""&&(se(""),C&&C(e,"","reset")),ye(0),te(0)):Ce(e,"previous");break}case"ArrowRight":!u&&D?(ye(-1),te(-1)):Ce(e,"next");break;case"Enter":if(M.current!==-1&&N){const r=S[M.current],l=F?F(r):!1;if(e.preventDefault(),l)return;de(e,r,"selectOption"),f&&w.current.setSelectionRange(w.current.value.length,w.current.value.length)}else T&&m!==""&&Ke===!1&&(u&&e.preventDefault(),de(e,m,"createOption","freeSolo"));break;case"Escape":N?(e.preventDefault(),e.stopPropagation(),Pe(e,"escape")):H&&(m!==""||u&&i.length>0||D)&&(e.preventDefault(),e.stopPropagation(),Qe(e));break;case"Backspace":if(u&&!Y&&m===""&&i.length>0){const r=V===-1?i.length-1:V,l=i.slice();l.splice(r,1),X(e,l,"removeOption",{option:i[r]})}!u&&D&&!Y&&m===""&&X(e,null,"removeOption",{option:i});break;case"Delete":if(u&&!Y&&m===""&&i.length>0&&V!==-1){const r=V,l=i.slice();l.splice(r,1),X(e,l,"removeOption",{option:i[r]})}!u&&D&&!Y&&m===""&&X(e,null,"removeOption",{option:i});break}},De=t=>{_e(!0),V!==-1&&(ye(-1),te(-1)),qe&&!We.current&&le(t)},Me=t=>{if(s(Z)){w.current.focus();return}_e(!1),Fe.current=!0,We.current=!1,P&&M.current!==-1&&N?de(t,S[M.current],"blur"):P&&T&&m!==""?de(t,m,"blur","freeSolo"):O&&ke(t,i,"blur"),Pe(t,"blur")},He=t=>{const e=t.target.value;m!==e&&(se(e),Te(!1),C&&C(t,e,"input")),e===""?!A&&!u&&!D&&X(t,null,"clear"):le(t)},ft=t=>{const e=Number(t.currentTarget.getAttribute("data-option-index"));M.current!==e&&ie({event:t,index:e,reason:"mouse"})},gt=t=>{ie({event:t,index:Number(t.currentTarget.getAttribute("data-option-index")),reason:"touch"}),ue.current=!0},ht=t=>{const e=Number(t.currentTarget.getAttribute("data-option-index"));de(t,S[e],"selectOption"),ue.current=!1},mt=t=>e=>{const r=i.slice();r.splice(t,1),X(e,r,"removeOption",{option:i[t]})},Ue=t=>{X(t,null,"removeOption",{option:i})},j=t=>{ae?Pe(t,"toggleInput"):le(t)},L=t=>{t.currentTarget.contains(t.target)&&t.target.getAttribute("id")!==B&&t.preventDefault()},fe=t=>{t.currentTarget.contains(t.target)&&(w.current.focus(),ze&&Fe.current&&w.current.selectionEnd-w.current.selectionStart===0&&w.current.select(),Fe.current=!1)},bt=t=>{!R&&(m===""||!ae)&&j(t)};let Be=T&&m.length>0;Be=Be||(u?i.length>0:i!==null);let Xe=S;return re&&(Xe=S.reduce((t,e,r)=>{const l=re(e);return t.length>0&&t[t.length-1].group===l?t[t.length-1].options.push(e):t.push({key:r,index:r,group:l,options:[e]}),t},[])),R&&Le&&Me(),{getRootProps:(t={})=>({...t,onKeyDown:dt(t),onMouseDown:L,onClick:fe}),getInputLabelProps:()=>({id:`${B}-label`,htmlFor:B}),getInputProps:()=>({id:B,value:m,onBlur:Me,onFocus:De,onChange:He,onMouseDown:bt,"aria-activedescendant":N?"":null,"aria-autocomplete":f?"both":"list","aria-controls":Ye?`${B}-listbox`:void 0,"aria-expanded":Ye,autoComplete:"off",ref:w,autoCapitalize:"none",spellCheck:"false",role:"combobox",disabled:R}),getClearProps:()=>({tabIndex:-1,type:"button",onClick:Qe}),getItemProps:({index:t=0}={})=>({...u&&{key:t},...D?{"data-item-index":t}:{"data-tag-index":t},tabIndex:-1,...!Y&&{onDelete:u?mt(t):Ue}}),getPopupIndicatorProps:()=>({tabIndex:-1,type:"button",onClick:j}),getTagProps:({index:t})=>({key:t,"data-tag-index":t,tabIndex:-1,...!Y&&{onDelete:mt(t)}}),getListboxProps:()=>({role:"listbox",id:`${B}-listbox`,"aria-labelledby":`${B}-label`,ref:ce,onMouseDown:t=>{t.preventDefault()}}),getOptionProps:({index:t,option:e})=>{const r=(u?i:[i]).some(p=>p!=null&&a(e,p)),l=F?F(e):!1;return{key:(g==null?void 0:g(e))??z(e),tabIndex:-1,role:"option",id:`${B}-option-${t}`,onMouseMove:ft,onClick:ht,onTouchStart:gt,"data-option-index":t,"aria-disabled":l,"aria-selected":r}},id:B,inputValue:m,value:i,dirty:Be,expanded:N&&Ee,popupOpen:N,focused:Le||V!==-1,anchorEl:Ee,setAnchorEl:wt,focusedItem:V,focusedTag:V,groupedOptions:Xe}}function xo(o){return qt("MuiListSubheader",o)}Zt("MuiListSubheader",["root","colorPrimary","colorInherit","gutters","inset","sticky"]);const Io=o=>{const{classes:s,color:c,disableGutters:f,inset:x,disableSticky:P}=o,I={root:["root",c!=="default"&&`color${at(c)}`,!f&&"gutters",x&&"inset",!P&&"sticky"]};return Kt(I,xo,s)},yo=_("li",{name:"MuiListSubheader",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:c}=o;return[s.root,c.color!=="default"&&s[`color${at(c.color)}`],!c.disableGutters&&s.gutters,c.inset&&s.inset,!c.disableSticky&&s.sticky]}})($e(({theme:o})=>({boxSizing:"border-box",lineHeight:"48px",listStyle:"none",color:(o.vars||o).palette.text.secondary,fontFamily:o.typography.fontFamily,fontWeight:o.typography.fontWeightMedium,fontSize:o.typography.pxToRem(14),variants:[{props:{color:"primary"},style:{color:(o.vars||o).palette.primary.main}},{props:{color:"inherit"},style:{color:"inherit"}},{props:({ownerState:s})=>!s.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:s})=>s.inset,style:{paddingLeft:72}},{props:({ownerState:s})=>!s.disableSticky,style:{position:"sticky",top:0,zIndex:1,backgroundColor:(o.vars||o).palette.background.paper}}]}))),At=b.forwardRef(function(s,c){const f=_t({props:s,name:"MuiListSubheader"}),{className:x,color:P="default",component:I="li",disableGutters:O=!1,disableSticky:H=!1,inset:W=!1,...$}=f,A={...f,color:P,component:I,disableGutters:O,disableSticky:H,inset:W},pe=Io(A);return n.jsx(yo,{as:I,className:st(pe.root,x),ref:c,ownerState:A,...$})});At&&(At.muiSkipListHighlight=!0);function So(o){return qt("MuiAutocomplete",o)}const d=Zt("MuiAutocomplete",["root","expanded","fullWidth","focused","focusVisible","tag","tagSizeSmall","tagSizeMedium","hasPopupIcon","hasClearIcon","inputRoot","input","inputFocused","endAdornment","clearIndicator","popupIndicator","popupIndicatorOpen","popper","popperDisablePortal","paper","listbox","loading","noOptions","option","groupLabel","groupUl"]);var Bt,Gt;const Po=o=>{const{classes:s,disablePortal:c,expanded:f,focused:x,fullWidth:P,hasClearIcon:I,hasPopupIcon:O,inputFocused:H,popupOpen:W,size:$}=o,A={root:["root",f&&"expanded",x&&"focused",P&&"fullWidth",I&&"hasClearIcon",O&&"hasPopupIcon"],inputRoot:["inputRoot"],input:["input",H&&"inputFocused"],tag:["tag",`tagSize${at($)}`],endAdornment:["endAdornment"],clearIndicator:["clearIndicator"],popupIndicator:["popupIndicator",W&&"popupIndicatorOpen"],popper:["popper",c&&"popperDisablePortal"],paper:["paper"],listbox:["listbox"],loading:["loading"],noOptions:["noOptions"],option:["option"],groupLabel:["groupLabel"],groupUl:["groupUl"]};return Kt(A,So,s)},Co=_("div",{name:"MuiAutocomplete",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:c}=o,{fullWidth:f,hasClearIcon:x,hasPopupIcon:P,inputFocused:I,size:O}=c;return[{[`& .${d.tag}`]:s.tag},{[`& .${d.tag}`]:s[`tagSize${at(O)}`]},{[`& .${d.inputRoot}`]:s.inputRoot},{[`& .${d.input}`]:s.input},{[`& .${d.input}`]:I&&s.inputFocused},s.root,f&&s.fullWidth,P&&s.hasPopupIcon,x&&s.hasClearIcon]}})({[`&.${d.focused} .${d.clearIndicator}`]:{visibility:"visible"},"@media (pointer: fine)":{[`&:hover .${d.clearIndicator}`]:{visibility:"visible"}},[`& .${d.tag}`]:{margin:3,maxWidth:"calc(100% - 6px)"},[`& .${d.inputRoot}`]:{[`.${d.hasPopupIcon}&, .${d.hasClearIcon}&`]:{paddingRight:30},[`.${d.hasPopupIcon}.${d.hasClearIcon}&`]:{paddingRight:56},[`& .${d.input}`]:{width:0,minWidth:30}},[`& .${St.root}`]:{paddingBottom:1,"& .MuiInput-input":{padding:"4px 4px 4px 0px"}},[`& .${St.root}.${ve.sizeSmall}`]:{[`& .${St.input}`]:{padding:"2px 4px 3px 0"}},[`& .${Wt.root}`]:{padding:9,[`.${d.hasPopupIcon}&, .${d.hasClearIcon}&`]:{paddingRight:39},[`.${d.hasPopupIcon}.${d.hasClearIcon}&`]:{paddingRight:65},[`& .${d.input}`]:{padding:"7.5px 4px 7.5px 5px"},[`& .${d.endAdornment}`]:{right:9}},[`& .${Wt.root}.${ve.sizeSmall}`]:{paddingTop:6,paddingBottom:6,paddingLeft:6,[`& .${d.input}`]:{padding:"2.5px 4px 2.5px 8px"}},[`& .${Re.root}`]:{paddingTop:19,paddingLeft:8,[`.${d.hasPopupIcon}&, .${d.hasClearIcon}&`]:{paddingRight:39},[`.${d.hasPopupIcon}.${d.hasClearIcon}&`]:{paddingRight:65},[`& .${Re.input}`]:{padding:"7px 4px"},[`& .${d.endAdornment}`]:{right:9}},[`& .${Re.root}.${ve.sizeSmall}`]:{paddingBottom:1,[`& .${Re.input}`]:{padding:"2.5px 4px"}},[`& .${ve.hiddenLabel}`]:{paddingTop:8},[`& .${Re.root}.${ve.hiddenLabel}`]:{paddingTop:0,paddingBottom:0,[`& .${d.input}`]:{paddingTop:16,paddingBottom:17}},[`& .${Re.root}.${ve.hiddenLabel}.${ve.sizeSmall}`]:{[`& .${d.input}`]:{paddingTop:8,paddingBottom:9}},[`& .${d.input}`]:{flexGrow:1,textOverflow:"ellipsis",opacity:0},variants:[{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{[`& .${d.tag}`]:{margin:2,maxWidth:"calc(100% - 4px)"}}},{props:{inputFocused:!0},style:{[`& .${d.input}`]:{opacity:1}}},{props:{multiple:!0},style:{[`& .${d.inputRoot}`]:{flexWrap:"wrap"}}}]}),vo=_("div",{name:"MuiAutocomplete",slot:"EndAdornment"})({position:"absolute",right:0,top:"50%",transform:"translate(0, -50%)"}),Oo=_(zt,{name:"MuiAutocomplete",slot:"ClearIndicator"})({marginRight:-2,padding:4,visibility:"hidden"}),$o=_(zt,{name:"MuiAutocomplete",slot:"PopupIndicator",overridesResolver:(o,s)=>{const{ownerState:c}=o;return[s.popupIndicator,c.popupOpen&&s.popupIndicatorOpen]}})({padding:2,marginRight:-2,variants:[{props:{popupOpen:!0},style:{transform:"rotate(180deg)"}}]}),Ao=_(Yt,{name:"MuiAutocomplete",slot:"Popper",overridesResolver:(o,s)=>{const{ownerState:c}=o;return[{[`& .${d.option}`]:s.option},s.popper,c.disablePortal&&s.popperDisablePortal]}})($e(({theme:o})=>({zIndex:(o.vars||o).zIndex.modal,variants:[{props:{disablePortal:!0},style:{position:"absolute"}}]}))),jo=_(jt,{name:"MuiAutocomplete",slot:"Paper"})($e(({theme:o})=>({...o.typography.body1,overflow:"auto"}))),zo=_("div",{name:"MuiAutocomplete",slot:"Loading"})($e(({theme:o})=>({color:(o.vars||o).palette.text.secondary,padding:"14px 16px"}))),wo=_("div",{name:"MuiAutocomplete",slot:"NoOptions"})($e(({theme:o})=>({color:(o.vars||o).palette.text.secondary,padding:"14px 16px"}))),Lo=_("ul",{name:"MuiAutocomplete",slot:"Listbox"})($e(({theme:o})=>({listStyle:"none",margin:0,padding:"8px 0",maxHeight:"40vh",overflow:"auto",position:"relative",[`& .${d.option}`]:{minHeight:48,display:"flex",overflow:"hidden",justifyContent:"flex-start",alignItems:"center",cursor:"pointer",paddingTop:6,boxSizing:"border-box",outline:"0",WebkitTapHighlightColor:"transparent",paddingBottom:6,paddingLeft:16,paddingRight:16,[o.breakpoints.up("sm")]:{minHeight:"auto"},[`&.${d.focused}`]:{backgroundColor:(o.vars||o).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},'&[aria-disabled="true"]':{opacity:(o.vars||o).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${d.focusVisible}`]:{backgroundColor:(o.vars||o).palette.action.focus},'&[aria-selected="true"]':{backgroundColor:o.alpha((o.vars||o).palette.primary.main,(o.vars||o).palette.action.selectedOpacity),[`&.${d.focused}`]:{backgroundColor:o.alpha((o.vars||o).palette.primary.main,`${(o.vars||o).palette.action.selectedOpacity} + ${(o.vars||o).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:(o.vars||o).palette.action.selected}},[`&.${d.focusVisible}`]:{backgroundColor:o.alpha((o.vars||o).palette.primary.main,`${(o.vars||o).palette.action.selectedOpacity} + ${(o.vars||o).palette.action.focusOpacity}`)}}}}))),ko=_(At,{name:"MuiAutocomplete",slot:"GroupLabel"})($e(({theme:o})=>({backgroundColor:(o.vars||o).palette.background.paper,top:-8}))),To=_("ul",{name:"MuiAutocomplete",slot:"GroupUl"})({padding:0,[`& .${d.option}`]:{paddingLeft:24}}),Do=b.forwardRef(function(s,c){const f=_t({props:s,name:"MuiAutocomplete"}),{autoComplete:x=!1,autoHighlight:P=!1,autoSelect:I=!1,blurOnSelect:O=!1,ChipProps:H,className:W,clearIcon:$=Bt||(Bt=n.jsx(ao,{fontSize:"small"})),clearOnBlur:A=!f.freeSolo,clearOnEscape:pe=!1,clearText:R="Clear",closeText:me="Close",componentsProps:Ae,defaultValue:oe=f.multiple?[]:null,disableClearable:ne=!1,disableCloseOnSelect:T=!1,disabled:F=!1,disabledItemsFocusable:g=!1,disableListWrap:be=!1,disablePortal:re=!1,filterOptions:Ne,filterSelectedOptions:U=!1,forcePopupIcon:xe="auto",freeSolo:je=!1,fullWidth:a=!1,getLimitTagsText:u=h=>`+${h}`,getOptionDisabled:E,getOptionKey:K,getOptionLabel:q,isOptionEqualToValue:C,groupBy:y,handleHomeEndKeys:Ie=!f.freeSolo,id:qe,includeInputInList:Ze=!1,inputValue:Y,limitTags:D=-1,ListboxComponent:ze,ListboxProps:we,loading:B=!1,loadingText:z="Loading…",multiple:We=!1,noOptionsText:Fe="No options",onChange:w,onClose:Z,onHighlightChange:Ee,onInputChange:wt,onOpen:V,open:ye,openOnFocus:it=!1,openText:M="Open",options:Lt,PaperComponent:i,PopperComponent:lt,popupIcon:m=Gt||(Gt=n.jsx(io,{})),readOnly:se=!1,renderGroup:Le,renderInput:_e,renderOption:ke,renderTags:ae,renderValue:Se,selectOnFocus:kt=!f.freeSolo,size:Te="medium",slots:Ke={},slotProps:N={},value:S,...J}=f,{getRootProps:Ye,getInputProps:te,getInputLabelProps:ut,getPopupIndicatorProps:ie,getClearProps:Q,getItemProps:Je,getListboxProps:pt,getOptionProps:Ve,value:ce,dirty:le,expanded:Pe,id:X,popupOpen:ue,focused:de,focusedItem:ct,anchorEl:Ce,setAnchorEl:Qe,inputValue:dt,groupedOptions:De}=bo({...f,componentName:"Autocomplete"}),Me=!ne&&!F&&le&&!se,He=(!je||xe===!0)&&xe!==!1,{onMouseDown:ft}=te(),{ref:gt,...ht}=pt(),Ue=q||(h=>h.label??h),j={...f,disablePortal:re,expanded:Pe,focused:de,fullWidth:a,getOptionLabel:Ue,hasClearIcon:Me,hasPopupIcon:He,inputFocused:ct===-1,popupOpen:ue,size:Te},L=Po(j),fe={slots:{paper:i,popper:lt,...Ke},slotProps:{chip:H,listbox:we,...Ae,...N}},[bt,Be]=xt("listbox",{elementType:Lo,externalForwardedProps:fe,ownerState:j,className:L.listbox,additionalProps:ht,ref:gt}),[Xe,t]=xt("paper",{elementType:jt,externalForwardedProps:fe,ownerState:j,className:L.paper}),[e,r]=xt("popper",{elementType:Yt,externalForwardedProps:fe,ownerState:j,className:L.popper,additionalProps:{disablePortal:re,style:{width:Ce?Ce.clientWidth:null},role:"presentation",anchorEl:Ce,open:ue}});let l;const p=h=>({className:L.tag,disabled:F,...Je(h)});if(We?ce.length>0&&(ae?l=ae(ce,p,j):Se?l=Se(ce,p,j):l=ce.map((h,ge)=>{const{key:he,...Ge}=p({index:ge});return n.jsx(lo,{label:Ue(h),size:Te,...Ge,...fe.slotProps.chip},he)})):Se&&ce!=null&&(l=Se(ce,p,j)),D>-1&&Array.isArray(l)){const h=l.length-D;!de&&h>0&&(l=l.splice(0,D),l.push(n.jsx("span",{className:L.tag,children:u(h)},l.length)))}const v=Le||(h=>n.jsxs("li",{children:[n.jsx(ko,{className:L.groupLabel,ownerState:j,component:"div",children:h.group}),n.jsx(To,{className:L.groupUl,ownerState:j,children:h.children})]},h.key)),et=ke||((h,ge)=>{const{key:he,...Ge}=h;return n.jsx("li",{...Ge,children:Ue(ge)},he)}),Tt=(h,ge)=>{const he=Ve({option:h,index:ge});return et({...he,className:L.option},h,{selected:he["aria-selected"],index:ge,inputValue:dt},j)},tt=fe.slotProps.clearIndicator,ot=fe.slotProps.popupIndicator;return n.jsxs(b.Fragment,{children:[n.jsx(Co,{ref:c,className:st(L.root,W),ownerState:j,...Ye(J),children:_e({id:X,disabled:F,fullWidth:!0,size:Te==="small"?"small":void 0,InputLabelProps:ut(),InputProps:{ref:Qe,className:L.inputRoot,startAdornment:l,onMouseDown:h=>{h.target===h.currentTarget&&ft(h)},...(Me||He)&&{endAdornment:n.jsxs(vo,{className:L.endAdornment,ownerState:j,children:[Me?n.jsx(Oo,{...Q(),"aria-label":R,title:R,ownerState:j,...tt,className:st(L.clearIndicator,tt==null?void 0:tt.className),children:$}):null,He?n.jsx($o,{...ie(),disabled:F,"aria-label":ue?me:M,title:ue?me:M,ownerState:j,...ot,className:st(L.popupIndicator,ot==null?void 0:ot.className),children:m}):null]})}},inputProps:{className:L.input,disabled:F,readOnly:se,...te()}})}),Ce?n.jsx(Ao,{as:e,...r,children:n.jsxs(jo,{as:Xe,...t,children:[B&&De.length===0?n.jsx(zo,{className:L.loading,ownerState:j,children:z}):null,De.length===0&&!je&&!B?n.jsx(wo,{className:L.noOptions,ownerState:j,role:"presentation",onMouseDown:h=>{h.preventDefault()},children:Fe}):null,De.length>0?n.jsx(bt,{as:ze,...Be,children:De.map((h,ge)=>y?v({key:h.key,group:h.group,children:h.options.map((he,Ge)=>Tt(he,h.index+Ge))}):Tt(h,ge))}):null]})}):null]})}),$t=["00","15","30","45"],Mo=Array.from({length:24},(o,s)=>String(s).padStart(2,"0"));function Ro(o){const s=o.getMinutes(),f=[0,15,30,45].reduce((P,I)=>Math.abs(s-P)<=Math.abs(s-I)?P:I),x=new Date(o);return x.setMinutes(f,0,0),{h:String(x.getHours()).padStart(2,"0"),m:String(x.getMinutes()).padStart(2,"0")}}function No(o){const s=o.getUTCMinutes(),f=[0,15,30,45].reduce((P,I)=>Math.abs(s-P)<=Math.abs(s-I)?P:I),x=o.getUTCHours();return{h:String(x).padStart(2,"0"),m:String(f).padStart(2,"0")}}function Xo(){const{id:o,patientId:s}=Xt(),c=eo(),f=to(),{success:x,error:P}=oo(),[I,O]=b.useState(!1),[H,W]=b.useState(!1),[$,A]=b.useState(""),[pe,R]=b.useState(!1),[me,Ae]=b.useState([]),oe=f.pathname.includes("/visits/new")||!o&&s,ne=f.pathname.includes("/visits/new")?o:s||o,T=f.pathname.includes("/visits/new")?void 0:o,F=(()=>{const a=new Date,{h:u,m:E}=Ro(a),K=a.getFullYear(),q=String(a.getMonth()+1).padStart(2,"0"),C=String(a.getDate()).padStart(2,"0"),y=$t.includes(E)?E:"00";return{datePart:`${K}-${q}-${C}`,hour:u,minute:y}})(),[g,be]=b.useState({patientId:ne||"",datePart:F.datePart,hour:F.hour,minute:F.minute,rodzajZabiegu:"",notatki:"",status:"ZAPLANOWANA",numerWSerii:"",liczbaSerii:"",cena:""});b.useEffect(()=>{ne?be(a=>({...a,patientId:ne})):re(),T&&!oe&&Ne()},[T,ne,oe]);const re=async()=>{try{W(!0);const a=await rt.get("/patients");Ae(a.data.patients||[])}catch{P("Nie udało się załadować listy pacjentów")}finally{W(!1)}},Ne=async()=>{var a,u,E,K,q;if(!(!T||oe))try{O(!0),A("");const y=(await rt.get(`/visits/${T}`)).data.visit;if(!y){A("Wizyta nie znaleziona"),O(!1);return}const Ie=new Date(y.data),qe=Ie.getUTCFullYear(),Ze=String(Ie.getUTCMonth()+1).padStart(2,"0"),Y=String(Ie.getUTCDate()).padStart(2,"0"),{h:D,m:ze}=No(Ie),we=$t.includes(ze)?ze:"00";be({patientId:y.patientId,datePart:`${qe}-${Ze}-${Y}`,hour:D,minute:we,rodzajZabiegu:y.rodzajZabiegu||"",notatki:y.notatki||"",status:y.status||"ZAPLANOWANA",numerWSerii:((a=y.numerWSerii)==null?void 0:a.toString())||"",liczbaSerii:((u=y.liczbaSerii)==null?void 0:u.toString())||"",cena:((E=y.cena)==null?void 0:E.toString())||""})}catch(C){A(((q=(K=C.response)==null?void 0:K.data)==null?void 0:q.error)||"Nie udało się załadować wizyty")}finally{O(!1)}},U=(a,u)=>{be(E=>({...E,[a]:u}))},xe=async a=>{var u,E,K,q;if(a.preventDefault(),A(""),R(!1),!g.patientId){A("Wybierz pacjenta");return}if(!g.rodzajZabiegu.trim()){A("Rodzaj zabiegu jest wymagany");return}try{O(!0);const C=`${g.datePart}T${g.hour}:${g.minute}`,y={patientId:g.patientId,data:C,rodzajZabiegu:g.rodzajZabiegu.trim(),status:g.status};g.notatki.trim()&&(y.notatki=g.notatki.trim()),g.numerWSerii&&(y.numerWSerii=parseInt(g.numerWSerii,10)),g.liczbaSerii&&(y.liczbaSerii=parseInt(g.liczbaSerii,10)),g.cena&&(y.cena=parseFloat(g.cena)),T&&!oe?(await rt.put(`/visits/${T}`,y),x("Wizyta została zaktualizowana")):(await rt.post("/visits",y),x("Wizyta została dodana")),R(!0),setTimeout(()=>{c(`/patients/${g.patientId}`)},1500)}catch(C){const y=((E=(u=C.response)==null?void 0:u.data)==null?void 0:E.message)||((q=(K=C.response)==null?void 0:K.data)==null?void 0:q.error)||"Błąd podczas zapisywania wizyty";A(y),P(y)}finally{O(!1)}},je=me.find(a=>a.id===g.patientId);return n.jsx(It,{sx:{width:"100%",maxWidth:"100%",overflow:"hidden"},children:n.jsxs(ro,{maxWidth:"lg",sx:{py:4,px:{xs:2,sm:3}},children:[n.jsxs(It,{sx:{mb:3,display:"flex",alignItems:"center",gap:2},children:[n.jsx(zt,{onClick:()=>c(-1),sx:{bgcolor:Dt("#1976d2",.1),"&:hover":{bgcolor:Dt("#1976d2",.2)}},children:n.jsx(so,{sx:{color:"#1976d2"}})}),n.jsx(Mt,{variant:"h4",sx:{fontWeight:600,color:"text.primary"},children:T&&!oe?"Edytuj wizytę":"Nowa wizyta / zabieg"})]}),$&&n.jsx(Nt,{severity:"error",sx:{mb:3},onClose:()=>A(""),children:$}),pe&&n.jsx(Nt,{severity:"success",sx:{mb:3},children:T&&!oe?"Wizyta została zaktualizowana":"Wizyta została dodana"}),n.jsx(jt,{sx:{p:{xs:2,sm:3},borderRadius:3,border:"1px solid",borderColor:"divider"},children:n.jsx("form",{onSubmit:xe,children:n.jsxs(G,{container:!0,spacing:3,children:[!ne&&n.jsx(G,{size:{xs:12},children:n.jsx(Do,{options:me,getOptionLabel:a=>`${a.firstName} ${a.lastName}`,value:je||null,onChange:(a,u)=>{U("patientId",(u==null?void 0:u.id)||"")},loading:H,renderInput:a=>n.jsx(Oe,{...a,label:"Pacjent *",required:!0,InputProps:{...a.InputProps,endAdornment:n.jsxs(n.Fragment,{children:[H?n.jsx(Rt,{size:20}):null,a.InputProps.endAdornment]})}})})}),n.jsx(G,{size:{xs:12,sm:4},children:n.jsx(Oe,{fullWidth:!0,label:"Data *",type:"date",value:g.datePart,onChange:a=>U("datePart",a.target.value),required:!0,InputLabelProps:{shrink:!0}})}),n.jsx(G,{size:{xs:12,sm:4},children:n.jsxs(Ct,{fullWidth:!0,required:!0,children:[n.jsx(vt,{children:"Godzina"}),n.jsx(Pt,{label:"Godzina",value:g.hour,onChange:a=>U("hour",a.target.value),children:Mo.map(a=>n.jsx(Ot,{value:a,children:a},a))})]})}),n.jsx(G,{size:{xs:12,sm:4},children:n.jsxs(Ct,{fullWidth:!0,required:!0,children:[n.jsx(vt,{children:"Minuty"}),n.jsx(Pt,{label:"Minuty",value:g.minute,onChange:a=>U("minute",a.target.value),children:$t.map(a=>n.jsxs(Ot,{value:a,children:[":",a]},a))})]})}),n.jsx(G,{size:{xs:12},children:n.jsx(Mt,{variant:"caption",color:"text.secondary",children:"Godzina w formacie 24h. Minuty: tylko 00, 15, 30, 45."})}),n.jsx(G,{size:{xs:12,md:6},children:n.jsx(Oe,{fullWidth:!0,label:"Rodzaj zabiegu *",value:g.rodzajZabiegu,onChange:a=>U("rodzajZabiegu",a.target.value),required:!0})}),n.jsx(G,{size:{xs:12,md:6},children:n.jsxs(Ct,{fullWidth:!0,children:[n.jsx(vt,{children:"Status"}),n.jsx(Pt,{value:g.status,onChange:a=>U("status",a.target.value),label:"Status",children:Object.entries(no).map(([a,u])=>n.jsx(Ot,{value:a,children:u.label},a))})]})}),n.jsx(G,{size:{xs:12,md:6},children:n.jsx(Oe,{fullWidth:!0,label:"Numer w serii",type:"number",value:g.numerWSerii,onChange:a=>U("numerWSerii",a.target.value),inputProps:{min:1}})}),n.jsx(G,{size:{xs:12,md:6},children:n.jsx(Oe,{fullWidth:!0,label:"Liczba serii",type:"number",value:g.liczbaSerii,onChange:a=>U("liczbaSerii",a.target.value),inputProps:{min:1}})}),n.jsx(G,{size:{xs:12,md:6},children:n.jsx(Oe,{fullWidth:!0,label:"Cena (zł)",type:"number",value:g.cena,onChange:a=>U("cena",a.target.value),inputProps:{min:0,step:.01},InputProps:{endAdornment:n.jsx(uo,{position:"end",children:"zł"})}})}),n.jsx(G,{size:{xs:12},children:n.jsx(Oe,{fullWidth:!0,label:"Notatki",multiline:!0,rows:4,value:g.notatki,onChange:a=>U("notatki",a.target.value)})}),n.jsx(G,{size:{xs:12},children:n.jsxs(It,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[n.jsx(Ft,{variant:"outlined",onClick:()=>c(-1),disabled:I,children:"Anuluj"}),n.jsx(Ft,{type:"submit",variant:"contained",startIcon:I?n.jsx(Rt,{size:20}):n.jsx(po,{}),disabled:I,sx:{bgcolor:"#1976d2","&:hover":{bgcolor:"#1565c0"}},children:I?"Zapisywanie...":"Zapisz"})]})})]})})})]})})}export{Xo as default};
