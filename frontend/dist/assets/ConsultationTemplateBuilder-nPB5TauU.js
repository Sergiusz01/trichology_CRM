import{c as _,j as e,r as h,B as c,T as u,P as E,I as v,D as G}from"./index-DuGlS2hS.js";import{u as V}from"./useNotification-DEJT79vM.js";import{G as d}from"./Grid-9JmJah-6.js";import{T as y,F as $,I as H}from"./TextField-VtT5fMIl.js";import{F as z,a as S}from"./Switch-BJM11GRR.js";import{B as p}from"./Button-DYA-l7Ix.js";import{A as D}from"./Add-CyAZE82m.js";import{A as J}from"./Alert-BnPrPNDn.js";import{S as I}from"./Stack-DKrDn8iz.js";import{C as k}from"./Chip-CKQ1KLG2.js";import{E as Q}from"./Edit-CC4dElt7.js";import{D as w}from"./Delete-XwNcIwF-.js";import{D as Y,a as ee,b as le,c as se}from"./DialogTitle-Cnb6c1S1.js";import{S as re}from"./Select-DgRGz9X7.js";import{M as ae}from"./MenuItem-0hJOb36H.js";import{C as ne}from"./Cancel-CIVKDdvV.js";import{S as L}from"./Save-6ATMd_0t.js";const te=_(e.jsx("path",{d:"M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2m-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}));function Te({template:a,onSave:F,onCancel:A}){const[m,W]=h.useState((a==null?void 0:a.name)||""),[n,b]=h.useState((a==null?void 0:a.fields)||[]),[C,q]=h.useState((a==null?void 0:a.isDefault)||!1),[f,g]=h.useState(null),[O,j]=h.useState(!1),[s,i]=h.useState({type:"TEXT",label:"",key:"",required:!1,order:n.length}),{error:x}=V(),T=[{value:"TEXT",label:"Tekst krótki"},{value:"TEXTAREA",label:"Tekst długi"},{value:"SELECT",label:"Wybór pojedynczy"},{value:"MULTISELECT",label:"Wybór wielokrotny"},{value:"CHECKBOX",label:"Checkbox"},{value:"NUMBER",label:"Liczba"},{value:"DATE",label:"Data"}],B=()=>{i({type:"TEXT",label:"",key:"",required:!1,order:n.length}),g(null),j(!0)},M=l=>{i(n[l]),g(l),j(!0)},K=l=>{const r=n.filter((t,o)=>o!==l);b(r.map((t,o)=>({...t,order:o})))},U=()=>{if(!s.label||!s.key){x("Etykieta i klucz są wymagane");return}if(!/^[a-zA-Z0-9_]+$/.test(s.key)){x("Klucz może zawierać tylko litery, cyfry i podkreślenia");return}if(n.some((t,o)=>t.key===s.key&&o!==f)){x("Klucz musi być unikalny");return}if((s.type==="SELECT"||s.type==="MULTISELECT")&&(!s.options||s.options.length===0)){x("Typy SELECT i MULTISELECT wymagają przynajmniej jednej opcji");return}const r={id:s.id,type:s.type,label:s.label,key:s.key,required:s.required||!1,placeholder:s.placeholder,options:s.options,defaultValue:s.defaultValue,order:s.order??n.length};if(f!==null){const t=[...n];t[f]=r,b(t)}else b([...n,r]);j(!1),i({type:"TEXT",label:"",key:"",required:!1,order:n.length+1}),g(null)},N=()=>{if(!m.trim()){x("Nazwa szablonu jest wymagana");return}if(n.length===0){x("Szablon musi zawierać przynajmniej jedno pole");return}F({id:a==null?void 0:a.id,name:m.trim(),fields:n.sort((l,r)=>l.order-r.order),isDefault:C,isActive:!0})},P=()=>{const l=s.options||[];i({...s,options:[...l,""]})},X=(l,r)=>{const o=[...s.options||[]];o[l]=r,i({...s,options:o})},R=l=>{const r=s.options||[];i({...s,options:r.filter((t,o)=>o!==l)})};return e.jsxs(c,{sx:{p:3},children:[e.jsx(u,{variant:"h5",sx:{mb:3,fontWeight:"bold"},children:a!=null&&a.id?"Edytuj szablon":"Nowy szablon konsultacji"}),e.jsx(E,{sx:{p:3,mb:3},children:e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Nazwa szablonu",value:m,onChange:l=>W(l.target.value),required:!0})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(z,{control:e.jsx(S,{checked:C,onChange:l=>q(l.target.checked)}),label:"Ustaw jako domyślny"})})]})}),e.jsxs(c,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(u,{variant:"h6",children:"Pola formularza"}),e.jsx(p,{variant:"contained",startIcon:e.jsx(D,{}),onClick:B,children:"Dodaj pole"})]}),n.length===0?e.jsx(J,{severity:"info",sx:{mb:2},children:'Brak pól. Kliknij "Dodaj pole", aby rozpocząć.'}):e.jsx(I,{spacing:2,children:n.sort((l,r)=>l.order-r.order).map((l,r)=>{var t;return e.jsx(E,{sx:{p:2},children:e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(c,{sx:{flex:1},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(te,{sx:{color:"text.secondary"}}),e.jsx(u,{variant:"subtitle1",sx:{fontWeight:"bold"},children:l.label}),e.jsx(k,{label:((t=T.find(o=>o.value===l.type))==null?void 0:t.label)||l.type,size:"small",color:"primary",variant:"outlined"}),l.required&&e.jsx(k,{label:"Wymagane",size:"small",color:"error"})]}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Klucz: ",e.jsx("code",{children:l.key})]}),l.placeholder&&e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Placeholder: ",l.placeholder]}),l.options&&l.options.length>0&&e.jsxs(c,{sx:{mt:1},children:[e.jsx(u,{variant:"body2",color:"text.secondary",children:"Opcje:"}),e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:.5},children:l.options.map((o,Z)=>e.jsx(k,{label:o,size:"small"},Z))})]})]}),e.jsxs(c,{children:[e.jsx(v,{color:"primary",onClick:()=>M(r),children:e.jsx(Q,{})}),e.jsx(v,{color:"error",onClick:()=>K(r),children:e.jsx(w,{})})]})]})},r)})}),e.jsxs(Y,{open:O,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(ee,{children:f!==null?"Edytuj pole":"Dodaj pole"}),e.jsx(le,{children:e.jsxs(d,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(d,{item:!0,xs:12,children:e.jsxs($,{fullWidth:!0,required:!0,children:[e.jsx(H,{children:"Typ pytania"}),e.jsx(re,{value:s.type,label:"Typ pytania",onChange:l=>i({...s,type:l.target.value,options:l.target.value==="SELECT"||l.target.value==="MULTISELECT"?s.options||[""]:void 0}),children:T.map(l=>e.jsx(ae,{value:l.value,children:l.label},l.value))})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Etykieta",value:s.label||"",onChange:l=>i({...s,label:l.target.value}),required:!0})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Klucz (identyfikator)",value:s.key||"",onChange:l=>i({...s,key:l.target.value}),required:!0,helperText:"Tylko litery, cyfry i podkreślenia"})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Placeholder",value:s.placeholder||"",onChange:l=>i({...s,placeholder:l.target.value})})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(z,{control:e.jsx(S,{checked:s.required||!1,onChange:l=>i({...s,required:l.target.checked})}),label:"Pole wymagane"})}),(s.type==="SELECT"||s.type==="MULTISELECT")&&e.jsxs(d,{item:!0,xs:12,children:[e.jsx(G,{sx:{my:2}}),e.jsx(u,{variant:"subtitle2",sx:{mb:1},children:"Opcje wyboru"}),e.jsxs(I,{spacing:1,children:[(s.options||[""]).map((l,r)=>e.jsxs(c,{sx:{display:"flex",gap:1},children:[e.jsx(y,{fullWidth:!0,size:"small",value:l,onChange:t=>X(r,t.target.value),placeholder:`Opcja ${r+1}`}),e.jsx(v,{color:"error",onClick:()=>R(r),disabled:(s.options||[]).length===1,children:e.jsx(w,{})})]},r)),e.jsx(p,{startIcon:e.jsx(D,{}),onClick:P,variant:"outlined",size:"small",children:"Dodaj opcję"})]})]})]})}),e.jsxs(se,{children:[e.jsx(p,{onClick:()=>j(!1),startIcon:e.jsx(ne,{}),children:"Anuluj"}),e.jsx(p,{onClick:U,variant:"contained",startIcon:e.jsx(L,{}),children:"Zapisz pole"})]})]}),e.jsxs(c,{sx:{mt:4,display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(p,{onClick:A,variant:"outlined",children:"Anuluj"}),e.jsx(p,{onClick:N,variant:"contained",startIcon:e.jsx(L,{}),disabled:!m.trim()||n.length===0,children:"Zapisz szablon"})]})]})}export{Te as C};
