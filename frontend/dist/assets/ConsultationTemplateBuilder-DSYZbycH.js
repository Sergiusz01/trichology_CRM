import{r as h,j as e,B as d,T as u,P as E,I as v,D as _}from"./index-ik9JjyS6.js";import{u as G}from"./useNotification-DgBW3D1z.js";import{G as c}from"./Grid-OOY2WAvo.js";import{T as y,F as V,I as $}from"./TextField-BNTsiTHM.js";import{F as z,a as S}from"./Switch-CMxXGKKJ.js";import{B as p}from"./Button-B6n5coYQ.js";import{A as D}from"./Add-BfAxRG2-.js";import{A as H}from"./Alert-Dzq7_ew3.js";import{S as w}from"./Stack-DcOE3fMJ.js";import{D as J}from"./DragIndicator-DX-HaPvZ.js";import{C as k}from"./Chip-pTV9ioJu.js";import{E as Q}from"./Edit-DimIYhJX.js";import{D as I}from"./Delete-rK6RFrLt.js";import{D as Y,a as ee,b as le,c as se}from"./DialogTitle-DX1gnFsJ.js";import{S as re}from"./Select--zggdXop.js";import{M as ae}from"./MenuItem-cD7WzH5Q.js";import{C as ne}from"./Cancel-CjIxMi8f.js";import{S as L}from"./Save-BBUZJYPl.js";function Te({template:a,onSave:F,onCancel:A}){const[m,W]=h.useState((a==null?void 0:a.name)||""),[n,b]=h.useState((a==null?void 0:a.fields)||[]),[C,q]=h.useState((a==null?void 0:a.isDefault)||!1),[f,g]=h.useState(null),[O,j]=h.useState(!1),[s,t]=h.useState({type:"TEXT",label:"",key:"",required:!1,order:n.length}),{error:x}=G(),T=[{value:"TEXT",label:"Tekst krótki"},{value:"TEXTAREA",label:"Tekst długi"},{value:"SELECT",label:"Wybór pojedynczy"},{value:"MULTISELECT",label:"Wybór wielokrotny"},{value:"CHECKBOX",label:"Checkbox"},{value:"NUMBER",label:"Liczba"},{value:"DATE",label:"Data"}],B=()=>{t({type:"TEXT",label:"",key:"",required:!1,order:n.length}),g(null),j(!0)},K=l=>{t(n[l]),g(l),j(!0)},M=l=>{const r=n.filter((i,o)=>o!==l);b(r.map((i,o)=>({...i,order:o})))},U=()=>{if(!s.label||!s.key){x("Etykieta i klucz są wymagane");return}if(!/^[a-zA-Z0-9_]+$/.test(s.key)){x("Klucz może zawierać tylko litery, cyfry i podkreślenia");return}if(n.some((i,o)=>i.key===s.key&&o!==f)){x("Klucz musi być unikalny");return}if((s.type==="SELECT"||s.type==="MULTISELECT")&&(!s.options||s.options.length===0)){x("Typy SELECT i MULTISELECT wymagają przynajmniej jednej opcji");return}const r={id:s.id,type:s.type,label:s.label,key:s.key,required:s.required||!1,placeholder:s.placeholder,options:s.options,defaultValue:s.defaultValue,order:s.order??n.length};if(f!==null){const i=[...n];i[f]=r,b(i)}else b([...n,r]);j(!1),t({type:"TEXT",label:"",key:"",required:!1,order:n.length+1}),g(null)},N=()=>{if(!m.trim()){x("Nazwa szablonu jest wymagana");return}if(n.length===0){x("Szablon musi zawierać przynajmniej jedno pole");return}F({id:a==null?void 0:a.id,name:m.trim(),fields:n.sort((l,r)=>l.order-r.order),isDefault:C,isActive:!0})},P=()=>{const l=s.options||[];t({...s,options:[...l,""]})},X=(l,r)=>{const o=[...s.options||[]];o[l]=r,t({...s,options:o})},R=l=>{const r=s.options||[];t({...s,options:r.filter((i,o)=>o!==l)})};return e.jsxs(d,{sx:{p:3},children:[e.jsx(u,{variant:"h5",sx:{mb:3,fontWeight:"bold"},children:a!=null&&a.id?"Edytuj szablon":"Nowy szablon konsultacji"}),e.jsx(E,{sx:{p:3,mb:3},children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Nazwa szablonu",value:m,onChange:l=>W(l.target.value),required:!0})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(z,{control:e.jsx(S,{checked:C,onChange:l=>q(l.target.checked)}),label:"Ustaw jako domyślny"})})]})}),e.jsxs(d,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(u,{variant:"h6",children:"Pola formularza"}),e.jsx(p,{variant:"contained",startIcon:e.jsx(D,{}),onClick:B,children:"Dodaj pole"})]}),n.length===0?e.jsx(H,{severity:"info",sx:{mb:2},children:'Brak pól. Kliknij "Dodaj pole", aby rozpocząć.'}):e.jsx(w,{spacing:2,children:n.sort((l,r)=>l.order-r.order).map((l,r)=>{var i;return e.jsx(E,{sx:{p:2},children:e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(d,{sx:{flex:1},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(J,{sx:{color:"text.secondary"}}),e.jsx(u,{variant:"subtitle1",sx:{fontWeight:"bold"},children:l.label}),e.jsx(k,{label:((i=T.find(o=>o.value===l.type))==null?void 0:i.label)||l.type,size:"small",color:"primary",variant:"outlined"}),l.required&&e.jsx(k,{label:"Wymagane",size:"small",color:"error"})]}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Klucz: ",e.jsx("code",{children:l.key})]}),l.placeholder&&e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Placeholder: ",l.placeholder]}),l.options&&l.options.length>0&&e.jsxs(d,{sx:{mt:1},children:[e.jsx(u,{variant:"body2",color:"text.secondary",children:"Opcje:"}),e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:.5},children:l.options.map((o,Z)=>e.jsx(k,{label:o,size:"small"},Z))})]})]}),e.jsxs(d,{children:[e.jsx(v,{color:"primary",onClick:()=>K(r),children:e.jsx(Q,{})}),e.jsx(v,{color:"error",onClick:()=>M(r),children:e.jsx(I,{})})]})]})},r)})}),e.jsxs(Y,{open:O,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(ee,{children:f!==null?"Edytuj pole":"Dodaj pole"}),e.jsx(le,{children:e.jsxs(c,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(c,{item:!0,xs:12,children:e.jsxs(V,{fullWidth:!0,required:!0,children:[e.jsx($,{children:"Typ pytania"}),e.jsx(re,{value:s.type,label:"Typ pytania",onChange:l=>t({...s,type:l.target.value,options:l.target.value==="SELECT"||l.target.value==="MULTISELECT"?s.options||[""]:void 0}),children:T.map(l=>e.jsx(ae,{value:l.value,children:l.label},l.value))})]})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Etykieta",value:s.label||"",onChange:l=>t({...s,label:l.target.value}),required:!0})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Klucz (identyfikator)",value:s.key||"",onChange:l=>t({...s,key:l.target.value}),required:!0,helperText:"Tylko litery, cyfry i podkreślenia"})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Placeholder",value:s.placeholder||"",onChange:l=>t({...s,placeholder:l.target.value})})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(z,{control:e.jsx(S,{checked:s.required||!1,onChange:l=>t({...s,required:l.target.checked})}),label:"Pole wymagane"})}),(s.type==="SELECT"||s.type==="MULTISELECT")&&e.jsxs(c,{item:!0,xs:12,children:[e.jsx(_,{sx:{my:2}}),e.jsx(u,{variant:"subtitle2",sx:{mb:1},children:"Opcje wyboru"}),e.jsxs(w,{spacing:1,children:[(s.options||[""]).map((l,r)=>e.jsxs(d,{sx:{display:"flex",gap:1},children:[e.jsx(y,{fullWidth:!0,size:"small",value:l,onChange:i=>X(r,i.target.value),placeholder:`Opcja ${r+1}`}),e.jsx(v,{color:"error",onClick:()=>R(r),disabled:(s.options||[]).length===1,children:e.jsx(I,{})})]},r)),e.jsx(p,{startIcon:e.jsx(D,{}),onClick:P,variant:"outlined",size:"small",children:"Dodaj opcję"})]})]})]})}),e.jsxs(se,{children:[e.jsx(p,{onClick:()=>j(!1),startIcon:e.jsx(ne,{}),children:"Anuluj"}),e.jsx(p,{onClick:U,variant:"contained",startIcon:e.jsx(L,{}),children:"Zapisz pole"})]})]}),e.jsxs(d,{sx:{mt:4,display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(p,{onClick:A,variant:"outlined",children:"Anuluj"}),e.jsx(p,{onClick:N,variant:"contained",startIcon:e.jsx(L,{}),disabled:!m.trim()||n.length===0,children:"Zapisz szablon"})]})]})}export{Te as C};
