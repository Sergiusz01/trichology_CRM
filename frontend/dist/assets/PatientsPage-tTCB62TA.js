import{c as Se,j as e,u as Ce,r as n,p as ke,n as Pe,o as We,q as f,B as o,T as l,C as $,P as Q,A as X,t as k,I as d,y as ve}from"./index-ik9JjyS6.js";import{u as Ne}from"./useNotification-DgBW3D1z.js";import{A as De,E as Ie,P as Te,R as Ae,D as Ee}from"./ErrorRetry-C7ldxede.js";import{C as Re}from"./Container-U9Ph7Onl.js";import{B as x}from"./Button-B6n5coYQ.js";import{A as $e}from"./Add-BfAxRG2-.js";import{T as Oe}from"./TextField-BNTsiTHM.js";import{I as Be}from"./InputAdornment-D5dmfE1O.js";import{S as Me}from"./Search-DNQVKwVt.js";import{G as P}from"./Grid-OOY2WAvo.js";import{C as ee}from"./Card-CoKfBisl.js";import{C as se}from"./CardContent-IdCV6dAg.js";import{P as re}from"./Person-BWLRddcv.js";import{V as ae}from"./Visibility-DK8cQTuR.js";import{D as te}from"./Delete-rK6RFrLt.js";import{S as Le}from"./Stack-DcOE3fMJ.js";import{T as Fe,a as Ue,b as He,c as W,d as i,e as Ze}from"./TableRow-D3npZos0.js";import{C as Ge}from"./Chip-pTV9ioJu.js";import{T as Ve}from"./TablePagination-CsvtqNHM.js";import{D as O,a as B,b as M,c as L}from"./DialogTitle-DX1gnFsJ.js";import{D as F}from"./DialogContentText-Dv-eACfQ.js";import"./Alert-Dzq7_ew3.js";import"./Refresh-F-fXWn1Z.js";import"./useThemeProps-C_QfMg4i.js";import"./Select--zggdXop.js";import"./KeyboardArrowRight-BF2dHtf7.js";import"./MenuItem-cD7WzH5Q.js";const Je=Se(e.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}));function Cs(){const{user:c}=Ce(),[g,ne]=n.useState([]),[U,H]=n.useState(!0),[v,Z]=n.useState(!1),[N,z]=n.useState(0),[D,ie]=n.useState(10),[I,oe]=n.useState(""),[le,ce]=n.useState(0),[m,xe]=n.useState(!1),[y,T]=n.useState({open:!1,patientId:null,patientName:""}),[w,A]=n.useState({open:!1,patientId:null,patientName:""}),[b,E]=n.useState({open:!1,patientId:null,patientName:""}),[Ke,me]=n.useState(""),[Ye,_e]=n.useState(""),[G,R]=n.useState(null),{success:S,error:C}=Ne(),p=ke(),h=Pe(),a=We(h.breakpoints.down("md")),de=(c==null?void 0:c.role)==="ADMIN"||(c==null?void 0:c.role)==="DOCTOR",pe=(c==null?void 0:c.role)==="ADMIN";n.useEffect(()=>{j()},[N,D,I,m]);const j=async()=>{var s,r;try{H(!0),R(null);const t=await f.get("/patients",{params:{page:N+1,limit:D,search:I,archived:m},_skipErrorToast:!0});ne(t.data.patients),ce(t.data.pagination.total)}catch(t){console.error("Błąd pobierania pacjentów:",t),R(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||"Nie udało się załadować listy pacjentów")}finally{H(!1)}},he=(s,r)=>{z(r)},je=s=>{ie(parseInt(s.target.value,10)),z(0)},V=(s,r)=>{T({open:!0,patientId:s,patientName:r})},ue=async()=>{var s,r;if(y.patientId)try{await f.delete(`/patients/${y.patientId}`),S("Pacjent został zarchiwizowany"),T({open:!1,patientId:null,patientName:""}),j()}catch(t){C(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||"Błąd podczas usuwania pacjenta")}},J=()=>{T({open:!1,patientId:null,patientName:""})},fe=(s,r)=>{A({open:!0,patientId:s,patientName:r})},ge=async()=>{var s,r;if(w.patientId)try{await f.post(`/patients/${w.patientId}/restore`),S("Pacjent został przywrócony"),A({open:!1,patientId:null,patientName:""}),j()}catch(t){C(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||"Błąd podczas przywracania pacjenta")}},K=()=>{A({open:!1,patientId:null,patientName:""})},ze=(s,r)=>{E({open:!0,patientId:s,patientName:r})},ye=async()=>{var s,r;if(b.patientId)try{await f.delete(`/patients/${b.patientId}/permanent`),S("Pacjent i wszystkie dane zostały trwale usunięte zgodnie z RODO"),E({open:!1,patientId:null,patientName:""}),j()}catch(t){C(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||"Błąd podczas trwałego usuwania pacjenta")}},Y=()=>{E({open:!1,patientId:null,patientName:""})},we=async()=>{var s,r;try{Z(!0),me("");const t=await f.get("/export/patients/zip",{responseType:"blob"}),q=window.URL.createObjectURL(new Blob([t.data])),u=document.createElement("a");u.href=q;const be=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);u.setAttribute("download",`eksport-pacjentow-${be}.zip`),document.body.appendChild(u),u.click(),u.remove(),window.URL.revokeObjectURL(q),S("Eksport zakończony pomyślnie")}catch(t){console.error("Błąd eksportu:",t),C(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||"Błąd podczas eksportu danych")}finally{Z(!1)}},_=(s,r)=>`${s.charAt(0)}${r.charAt(0)}`.toUpperCase();return e.jsx(Re,{maxWidth:"xl",sx:{px:{xs:1,sm:2,md:3}},children:e.jsxs(o,{sx:{mb:{xs:2,sm:3}},children:[e.jsxs(o,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:{xs:1.5,sm:2},gap:{xs:1.5,sm:2}},children:[e.jsxs(o,{sx:{width:{xs:"100%",sm:"auto"}},children:[e.jsx(l,{variant:"h4",component:"h1",sx:{fontWeight:800,mb:1,fontSize:{xs:"1.75rem",sm:"2.5rem"},background:"linear-gradient(135deg, #007AFF 0%, #00C7BE 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Pacjenci"}),e.jsx(l,{variant:"body1",color:"text.secondary",sx:{fontSize:{xs:"0.875rem",sm:"1rem"},fontWeight:500},children:"Zarządzaj bazą pacjentów i ich historią medyczną"})]}),e.jsxs(o,{sx:{display:"flex",gap:{xs:1,sm:2},flexWrap:"wrap",width:{xs:"100%",sm:"auto"},"& > *":{flex:{xs:"1 1 auto",sm:"0 0 auto"},minWidth:{xs:"auto",sm:"120px"}}},children:[e.jsx(x,{variant:m?"outlined":"contained",startIcon:e.jsx(De,{}),onClick:()=>{xe(!m),z(0)},sx:{textTransform:"none",fontWeight:600,fontSize:{xs:"0.75rem",sm:"0.875rem"},px:{xs:1.5,sm:2}},size:a?"small":"medium",children:m?"Aktywni":"Zarchiwizowani"}),de&&!m&&e.jsx(x,{variant:"outlined",startIcon:v?e.jsx($,{size:20}):e.jsx(Je,{}),onClick:we,disabled:v,sx:{textTransform:"none",fontWeight:600,fontSize:{xs:"0.75rem",sm:"0.875rem"},px:{xs:1.5,sm:2}},size:a?"small":"medium",children:v?a?"Eksport...":"Eksportowanie...":a?"Eksport":"Eksportuj dane"}),!m&&e.jsx(x,{variant:"contained",startIcon:e.jsx($e,{}),onClick:()=>p("/patients/new"),sx:{textTransform:"none",fontWeight:700,borderRadius:2,fontSize:{xs:"0.8125rem",sm:"0.875rem"},px:{xs:2,sm:3},py:1.2},size:"medium",fullWidth:a,children:"NOWY PACJENT"})]})]}),G&&e.jsx(Ie,{message:G,onRetry:j,onClose:()=>R(null)}),e.jsx(Q,{sx:{p:{xs:1,sm:2},mb:4,borderRadius:3,border:"1px solid",borderColor:"divider",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:e.jsx(Oe,{fullWidth:!0,placeholder:a?"Szukaj pacjenta...":"Szukaj po imieniu, nazwisku, nr telefonu lub emailu...",value:I,onChange:s=>{oe(s.target.value),z(0)},size:a?"small":"medium",InputProps:{startAdornment:e.jsx(Be,{position:"start",children:e.jsx(Me,{sx:{color:"primary.main"},fontSize:a?"small":"medium"})}),sx:{borderRadius:2.5}}})}),a?e.jsx(P,{container:!0,spacing:2,children:U?e.jsx(P,{size:{xs:12},children:e.jsx(o,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx($,{})})}):g.length===0?e.jsx(P,{size:{xs:12},children:e.jsx(ee,{children:e.jsx(se,{children:e.jsxs(o,{sx:{textAlign:"center",py:4},children:[e.jsx(re,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(l,{color:"text.secondary",children:"Brak pacjentów"})]})})})}):g.map(s=>e.jsx(P,{size:{xs:12},children:e.jsx(ee,{sx:{borderRadius:3,border:"1px solid",borderColor:"divider",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",transition:"all 0.2s ease-in-out","&:active":{transform:"scale(0.98)"}},onClick:()=>p(`/patients/${s.id}`),children:e.jsxs(se,{sx:{p:2.5},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(X,{sx:{width:50,height:50,bgcolor:k(h.palette.primary.main,.1),color:"primary.main",fontWeight:700,fontSize:"1.2rem",border:`2px solid ${k(h.palette.primary.main,.2)}`},children:_(s.firstName,s.lastName)}),e.jsxs(o,{children:[e.jsxs(l,{variant:"subtitle1",sx:{fontWeight:700,lineHeight:1.2},children:[s.firstName," ",s.lastName]}),e.jsxs(l,{variant:"caption",color:"text.secondary",sx:{fontWeight:500},children:[s.age?`${s.age} lat`:"Wiek nieznany"," • ",s.gender==="MALE"?"Mężczyzna":"Kobieta"]})]})]}),e.jsxs(o,{sx:{display:"flex"},children:[e.jsx(d,{size:"small",onClick:r=>{r.stopPropagation(),p(`/patients/${s.id}`)},sx:{color:"primary.main",bgcolor:k(h.palette.primary.main,.05),mr:.5},children:e.jsx(ae,{fontSize:"small"})}),e.jsx(d,{size:"small",color:"error",onClick:r=>{r.stopPropagation(),V(s.id,`${s.firstName} ${s.lastName}`)},sx:{bgcolor:k(h.palette.error.main,.05)},children:e.jsx(te,{fontSize:"small"})})]})]}),e.jsxs(Le,{spacing:1,children:[s.phone&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Te,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(l,{variant:"body2",color:"text.primary",sx:{fontWeight:500},children:s.phone})]}),s.email&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ve,{sx:{fontSize:16,color:"text.secondary"}}),e.jsx(l,{noWrap:!0,variant:"body2",color:"text.primary",sx:{fontWeight:500},children:s.email})]})]})]})})},s.id))}):e.jsxs(Fe,{component:Q,sx:{overflowX:"auto",WebkitOverflowScrolling:"touch"},children:[e.jsxs(Ue,{sx:{minWidth:650},children:[e.jsx(He,{children:e.jsxs(W,{children:[e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontWeight:600,whiteSpace:"nowrap"},children:"Imię i nazwisko"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:"Wiek"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:"Płeć"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap",display:{xs:"none",md:"table-cell"}},children:"Telefon"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap",display:{xs:"none",lg:"table-cell"}},children:"Email"}),e.jsx(i,{align:"right",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:"Akcje"})]})}),e.jsx(Ze,{children:U?e.jsx(W,{children:e.jsx(i,{colSpan:6,align:"center",sx:{py:4},children:e.jsx($,{})})}):g.length===0?e.jsx(W,{children:e.jsxs(i,{colSpan:6,align:"center",sx:{py:4},children:[e.jsx(re,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(l,{color:"text.secondary",children:"Brak pacjentów"})]})}):g.map(s=>e.jsxs(W,{hover:!0,sx:{cursor:"pointer"},onClick:()=>p(`/patients/${s.id}`),children:[e.jsx(i,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(X,{sx:{bgcolor:"primary.main",width:40,height:40,fontSize:"0.9rem",fontWeight:"bold"},children:_(s.firstName,s.lastName)}),e.jsxs(l,{sx:{fontWeight:500},children:[s.firstName," ",s.lastName]})]})}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.age||"-"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.gender&&e.jsx(Ge,{label:s.gender==="MALE"?"M":s.gender==="FEMALE"?"K":"-",size:"small",color:s.gender==="MALE"?"primary":"secondary",sx:{fontSize:{xs:"0.65rem",sm:"0.75rem"},height:{xs:20,sm:24}}})}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},display:{xs:"none",md:"table-cell"}},children:s.phone||"-"}),e.jsx(i,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},display:{xs:"none",lg:"table-cell"},maxWidth:{lg:200},overflow:"hidden",textOverflow:"ellipsis"},children:s.email||"-"}),e.jsxs(i,{align:"right",children:[e.jsx(d,{size:"small",onClick:r=>{r.stopPropagation(),p(`/patients/${s.id}`)},children:e.jsx(ae,{})}),m?e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"small",color:"success",onClick:r=>{r.stopPropagation(),fe(s.id,`${s.firstName} ${s.lastName}`)},title:"Przywróć pacjenta",children:e.jsx(Ae,{})}),pe&&e.jsx(d,{size:"small",color:"error",onClick:r=>{r.stopPropagation(),ze(s.id,`${s.firstName} ${s.lastName}`)},title:"Trwale usuń (RODO)",children:e.jsx(Ee,{})})]}):e.jsx(d,{size:"small",color:"error",onClick:r=>{r.stopPropagation(),V(s.id,`${s.firstName} ${s.lastName}`)},children:e.jsx(te,{})})]})]},s.id))})]}),e.jsx(Ve,{component:"div",count:le,page:N,onPageChange:he,rowsPerPage:D,onRowsPerPageChange:je,rowsPerPageOptions:[10,25,50],labelRowsPerPage:a?"Na stronie:":"Wierszy na stronę:",sx:{"& .MuiTablePagination-toolbar":{flexWrap:"wrap",gap:1},"& .MuiTablePagination-selectLabel, & .MuiTablePagination-displayedRows":{fontSize:{xs:"0.75rem",sm:"0.875rem"}}}})]}),e.jsxs(O,{open:y.open,onClose:J,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{m:{xs:2,sm:3},width:{xs:"calc(100% - 32px)",sm:"auto"}}},children:[e.jsx(B,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Potwierdzenie usunięcia"}),e.jsx(M,{children:e.jsxs(F,{sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:["Czy na pewno chcesz zarchiwizować pacjenta ",e.jsx("strong",{children:y.patientName}),"?",e.jsx(l,{variant:"body2",color:"warning.main",sx:{mt:2,p:{xs:1.5,sm:2},bgcolor:"warning.50",borderRadius:1,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:"⚠️ Uwaga: Pacjent zostanie zarchiwizowany (soft delete). Wszystkie powiązane dane pozostaną w systemie."})]})}),e.jsxs(L,{sx:{px:{xs:2,sm:3},pb:{xs:2,sm:3}},children:[e.jsx(x,{onClick:J,size:a?"small":"medium",children:"Anuluj"}),e.jsx(x,{onClick:ue,color:"error",variant:"contained",size:a?"small":"medium",children:"Zarchiwizuj"})]})]}),e.jsxs(O,{open:w.open,onClose:K,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{m:{xs:2,sm:3},width:{xs:"calc(100% - 32px)",sm:"auto"}}},children:[e.jsx(B,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Przywróć pacjenta"}),e.jsx(M,{children:e.jsxs(F,{sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:["Czy na pewno chcesz przywrócić pacjenta ",e.jsx("strong",{children:w.patientName}),"? Pacjent zostanie przywrócony do aktywnej listy."]})}),e.jsxs(L,{sx:{px:{xs:2,sm:3},pb:{xs:2,sm:3}},children:[e.jsx(x,{onClick:K,size:a?"small":"medium",children:"Anuluj"}),e.jsx(x,{onClick:ge,color:"success",variant:"contained",size:a?"small":"medium",children:"Przywróć"})]})]}),e.jsxs(O,{open:b.open,onClose:Y,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{m:{xs:2,sm:3},width:{xs:"calc(100% - 32px)",sm:"auto"}}},children:[e.jsx(B,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:"Trwałe usunięcie danych (RODO)"}),e.jsx(M,{children:e.jsxs(F,{sx:{fontSize:{xs:"0.875rem",sm:"1rem"}},children:[e.jsx("strong",{children:"UWAGA: Ta operacja jest nieodwracalna!"}),e.jsx("br",{}),e.jsx("br",{}),"Czy na pewno chcesz trwale usunąć pacjenta ",e.jsx("strong",{children:b.patientName})," i wszystkie powiązane dane?",e.jsx("br",{}),e.jsx("br",{}),"Zostaną usunięte:",e.jsxs("ul",{style:{marginLeft:a?"16px":"20px",paddingLeft:a?"8px":"12px",fontSize:a?"0.875rem":"1rem"},children:[e.jsx("li",{children:"Wszystkie konsultacje"}),e.jsx("li",{children:"Wszystkie wyniki badań"}),e.jsx("li",{children:"Wszystkie zdjęcia skóry głowy (również pliki)"}),e.jsx("li",{children:"Wszystkie plany opieki"}),e.jsx("li",{children:"Historia emaili"}),e.jsx("li",{children:"Wszystkie przypomnienia"})]}),"Ta operacja jest zgodna z RODO i nie może być cofnięta."]})}),e.jsxs(L,{sx:{px:{xs:2,sm:3},pb:{xs:2,sm:3}},children:[e.jsx(x,{onClick:Y,size:a?"small":"medium",children:"Anuluj"}),e.jsx(x,{onClick:ye,color:"error",variant:"contained",size:a?"small":"medium",children:"Trwale usuń"})]})]})]})})}export{Cs as default};
