import{c as U,j as i,N as O,p as G,n as Z,o as q,r as p,q as z,B as d,C,T as x,P as M,D as h}from"./index-DuGlS2hS.js";import{S as J}from"./Science-CQ1rCQXw.js";import{A as T}from"./Alert-BnPrPNDn.js";import{G as t}from"./Grid-9JmJah-6.js";import{T as u}from"./TextField-VtT5fMIl.js";import{I as Q}from"./InputAdornment-BplF7Ie4.js";import{A as v,a as L,E as y,b as H}from"./ExpandMore-BJqjhfSV.js";import{A as F}from"./Assignment-C5Fn19Y0.js";import{B as E}from"./Button-DYA-l7Ix.js";import{C as X}from"./Cancel-CIVKDdvV.js";import{S as Y}from"./Save-6ATMd_0t.js";import"./useThemeProps-CESs6Os5.js";import"./Select-DgRGz9X7.js";const _=U(i.jsx("path",{d:"M12 2c-5.33 4.55-8 8.48-8 11.8 0 4.98 3.8 8.2 8 8.2s8-3.22 8-8.2c0-3.32-2.67-7.25-8-11.8m3 16H9v-2h6zm0-5h-2v2h-2v-2H9v-2h2V9h2v2h2z"})),ii=U(i.jsx("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V10h14zM9 14H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2zm-8 4H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2z"})),ei=U([i.jsx("path",{d:"M15.11 12.45 14 10.24l-3.11 6.21c-.16.34-.51.55-.89.55s-.73-.21-.89-.55L7.38 13H2v5c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-5h-6c-.38 0-.73-.21-.89-.55"},"0"),i.jsx("path",{d:"M20 4H4c-1.1 0-2 .9-2 2v5h6c.38 0 .73.21.89.55L10 13.76l3.11-6.21c.34-.68 1.45-.68 1.79 0L16.62 11H22V6c0-1.1-.9-2-2-2"},"1")]),ti=U(i.jsx("path",{d:"M17.66 8 12 2.35 6.34 8C4.78 9.56 4 11.64 4 13.64s.78 4.11 2.34 5.67 3.61 2.35 5.66 2.35 4.1-.79 5.66-2.35S20 15.64 20 13.64 19.22 9.56 17.66 8M6 14c.01-2 .62-3.27 1.76-4.4L12 5.27l4.24 4.38C17.38 10.77 17.99 12 18 14z"}));function ui(){const{id:m,labResultId:c}=O(),I=G(),P=Z(),S=q(P.breakpoints.down("sm")),[$,D]=p.useState(!1),[R,B]=p.useState(!1),[A,w]=p.useState(""),[V,W]=p.useState(!1),[n,k]=p.useState({patientId:m||"",consultationId:"",date:new Date().toISOString().split("T")[0],hgb:"",hgbUnit:"g/dL",hgbRefLow:"",hgbRefHigh:"",rbc:"",rbcUnit:"M/μL",rbcRefLow:"",rbcRefHigh:"",wbc:"",wbcUnit:"K/μL",wbcRefLow:"",wbcRefHigh:"",plt:"",pltUnit:"K/μL",pltRefLow:"",pltRefHigh:"",ferritin:"",ferritinUnit:"ng/mL",ferritinRefLow:"",ferritinRefHigh:"",iron:"",ironUnit:"μg/dL",ironRefLow:"",ironRefHigh:"",vitaminD3:"",vitaminD3Unit:"ng/mL",vitaminD3RefLow:"",vitaminD3RefHigh:"",vitaminB12:"",vitaminB12Unit:"pg/mL",vitaminB12RefLow:"",vitaminB12RefHigh:"",folicAcid:"",folicAcidUnit:"ng/mL",folicAcidRefLow:"",folicAcidRefHigh:"",tsh:"",tshUnit:"mIU/L",tshRefLow:"",tshRefHigh:"",ft3:"",ft3Unit:"pg/mL",ft3RefLow:"",ft3RefHigh:"",ft4:"",ft4Unit:"ng/dL",ft4RefLow:"",ft4RefHigh:"",notes:""}),g=(r,s)=>{k(o=>({...o,[r]:s}))},K=async r=>{var s,o;r.preventDefault(),B(!0),w(""),W(!1);try{const e={patientId:n.patientId,date:n.date?new Date(n.date).toISOString():void 0,consultationId:n.consultationId||void 0,notes:n.notes||void 0},j=f=>f===""?void 0:parseFloat(f);["hgb","hgbRefLow","hgbRefHigh","rbc","rbcRefLow","rbcRefHigh","wbc","wbcRefLow","wbcRefHigh","plt","pltRefLow","pltRefHigh","ferritin","ferritinRefLow","ferritinRefHigh","iron","ironRefLow","ironRefHigh","vitaminD3","vitaminD3RefLow","vitaminD3RefHigh","vitaminB12","vitaminB12RefLow","vitaminB12RefHigh","folicAcid","folicAcidRefLow","folicAcidRefHigh","tsh","tshRefLow","tshRefHigh","ft3","ft3RefLow","ft3RefHigh","ft4","ft4RefLow","ft4RefHigh"].forEach(f=>{const b=j(n[f]);b!==void 0&&(e[f]=b)}),["hgbUnit","rbcUnit","wbcUnit","pltUnit","ferritinUnit","ironUnit","vitaminD3Unit","vitaminB12Unit","folicAcidUnit","tshUnit","ft3Unit","ft4Unit"].forEach(f=>{const b=n[f];b&&(e[f]=b)}),c?await z.put(`/lab-results/${c}`,e):await z.post("/lab-results",e),W(!0),setTimeout(()=>{I(`/patients/${m}`)},1500)}catch(e){console.error("Błąd zapisywania wyniku:",e),w(((o=(s=e.response)==null?void 0:s.data)==null?void 0:o.error)||e.message||"Błąd zapisywania wyniku")}finally{B(!1)}};p.useEffect(()=>{c&&m&&N()},[c,m]);const N=async()=>{var r,s;if(c)try{D(!0);const e=(await z.get(`/lab-results/${c}`)).data.labResult;k({patientId:e.patientId||m||"",consultationId:e.consultationId||"",date:e.date?new Date(e.date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],hgb:e.hgb||"",hgbUnit:e.hgbUnit||"g/dL",hgbRefLow:e.hgbRefLow||"",hgbRefHigh:e.hgbRefHigh||"",rbc:e.rbc||"",rbcUnit:e.rbcUnit||"M/μL",rbcRefLow:e.rbcRefLow||"",rbcRefHigh:e.rbcRefHigh||"",wbc:e.wbc||"",wbcUnit:e.wbcUnit||"K/μL",wbcRefLow:e.wbcRefLow||"",wbcRefHigh:e.wbcRefHigh||"",plt:e.plt||"",pltUnit:e.pltUnit||"K/μL",pltRefLow:e.pltRefLow||"",pltRefHigh:e.pltRefHigh||"",ferritin:e.ferritin||"",ferritinUnit:e.ferritinUnit||"ng/mL",ferritinRefLow:e.ferritinRefLow||"",ferritinRefHigh:e.ferritinRefHigh||"",iron:e.iron||"",ironUnit:e.ironUnit||"μg/dL",ironRefLow:e.ironRefLow||"",ironRefHigh:e.ironRefHigh||"",vitaminD3:e.vitaminD3||"",vitaminD3Unit:e.vitaminD3Unit||"ng/mL",vitaminD3RefLow:e.vitaminD3RefLow||"",vitaminD3RefHigh:e.vitaminD3RefHigh||"",vitaminB12:e.vitaminB12||"",vitaminB12Unit:e.vitaminB12Unit||"pg/mL",vitaminB12RefLow:e.vitaminB12RefLow||"",vitaminB12RefHigh:e.vitaminB12RefHigh||"",folicAcid:e.folicAcid||"",folicAcidUnit:e.folicAcidUnit||"ng/mL",folicAcidRefLow:e.folicAcidRefLow||"",folicAcidRefHigh:e.folicAcidRefHigh||"",tsh:e.tsh||"",tshUnit:e.tshUnit||"mIU/L",tshRefLow:e.tshRefLow||"",tshRefHigh:e.tshRefHigh||"",ft3:e.ft3||"",ft3Unit:e.ft3Unit||"pg/mL",ft3RefLow:e.ft3RefLow||"",ft3RefHigh:e.ft3RefHigh||"",ft4:e.ft4||"",ft4Unit:e.ft4Unit||"ng/dL",ft4RefLow:e.ft4RefLow||"",ft4RefHigh:e.ft4RefHigh||"",notes:e.notes||""})}catch(o){console.error("Błąd pobierania wyniku:",o),w(((s=(r=o.response)==null?void 0:r.data)==null?void 0:s.error)||"Błąd pobierania wyniku")}finally{D(!1)}};if($||R&&!n.patientId)return i.jsx(d,{sx:{display:"flex",justifyContent:"center",p:3},children:i.jsx(C,{})});return i.jsxs(d,{sx:{width:"100%",maxWidth:"100%",overflow:"hidden",px:{xs:0,sm:0}},children:[i.jsxs(x,{variant:"h4",gutterBottom:!0,sx:{fontSize:{xs:"1.75rem",sm:"2.25rem"},fontWeight:700,mb:4,color:"primary.main",display:"flex",alignItems:"center",gap:2},children:[i.jsx(J,{fontSize:"large"}),c?"Edytuj wynik badania":"Nowy wynik badania"]}),A&&i.jsx(T,{severity:"error",sx:{mb:3,borderRadius:2},onClose:()=>w(""),children:A}),V&&i.jsx(T,{severity:"success",sx:{mb:3,borderRadius:2},children:"Wynik zapisany pomyślnie!"}),i.jsxs("form",{onSubmit:K,children:[i.jsx(M,{sx:{p:{xs:2,sm:3},mb:3,borderRadius:3,overflow:"hidden",elevation:2},children:i.jsx(t,{container:!0,spacing:3,children:i.jsx(t,{size:{xs:12,sm:6,md:4},children:i.jsx(u,{fullWidth:!0,label:"Data badania",type:"date",value:n.date,onChange:r=>g("date",r.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:i.jsx(Q,{position:"start",children:i.jsx(ii,{color:"action"})})}})})})}),i.jsxs(d,{sx:{display:"flex",flexDirection:"column",gap:2},children:[i.jsxs(v,{defaultExpanded:!0,sx:{borderRadius:2,"&:before":{display:"none"},boxShadow:1},children:[i.jsx(L,{expandIcon:i.jsx(y,{}),children:i.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[i.jsx(_,{color:"error"}),i.jsx(x,{variant:"h6",fontWeight:600,children:"Morfologia"})]})}),i.jsx(H,{sx:{p:{xs:2,sm:3}},children:i.jsxs(t,{container:!0,spacing:3,children:[a("HGB","hgb"),i.jsx(t,{size:{xs:12},children:i.jsx(h,{sx:{my:1,opacity:.6}})}),a("RBC","rbc"),i.jsx(t,{size:{xs:12},children:i.jsx(h,{sx:{my:1,opacity:.6}})}),a("WBC","wbc"),i.jsx(t,{size:{xs:12},children:i.jsx(h,{sx:{my:1,opacity:.6}})}),a("PLT","plt")]})})]}),i.jsxs(v,{sx:{borderRadius:2,"&:before":{display:"none"},boxShadow:1},children:[i.jsx(L,{expandIcon:i.jsx(y,{}),children:i.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[i.jsx(ti,{color:"error"}),i.jsx(x,{variant:"h6",fontWeight:600,children:"Gospodarka żelazowa"})]})}),i.jsx(H,{sx:{p:{xs:2,sm:3}},children:i.jsxs(t,{container:!0,spacing:3,children:[a("Ferrytyna","ferritin"),i.jsx(t,{size:{xs:12},children:i.jsx(h,{sx:{my:1,opacity:.6}})}),a("Żelazo","iron")]})})]}),i.jsxs(v,{sx:{borderRadius:2,"&:before":{display:"none"},boxShadow:1},children:[i.jsx(L,{expandIcon:i.jsx(y,{}),children:i.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[i.jsx(ei,{color:"primary"}),i.jsx(x,{variant:"h6",fontWeight:600,children:"Witaminy"})]})}),i.jsx(H,{sx:{p:{xs:2,sm:3}},children:i.jsxs(t,{container:!0,spacing:3,children:[a("Witamina D3","vitaminD3"),i.jsx(t,{size:{xs:12},children:i.jsx(h,{sx:{my:1,opacity:.6}})}),a("Witamina B12","vitaminB12"),i.jsx(t,{size:{xs:12},children:i.jsx(h,{sx:{my:1,opacity:.6}})}),a("Kwas foliowy","folicAcid")]})})]}),i.jsxs(v,{sx:{borderRadius:2,"&:before":{display:"none"},boxShadow:1},children:[i.jsx(L,{expandIcon:i.jsx(y,{}),children:i.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[i.jsx(F,{color:"info"}),i.jsx(x,{variant:"h6",fontWeight:600,children:"Tarczyca"})]})}),i.jsx(H,{sx:{p:{xs:2,sm:3}},children:i.jsxs(t,{container:!0,spacing:3,children:[a("TSH","tsh"),i.jsx(t,{size:{xs:12},children:i.jsx(h,{sx:{my:1,opacity:.6}})}),a("FT3","ft3"),i.jsx(t,{size:{xs:12},children:i.jsx(h,{sx:{my:1,opacity:.6}})}),a("FT4","ft4")]})})]}),i.jsxs(M,{sx:{p:{xs:2,sm:3},borderRadius:2,mt:1,boxShadow:1},children:[i.jsxs(x,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[i.jsx(F,{fontSize:"small",color:"action"}),"Notatki i uwagi dodatkowe"]}),i.jsx(u,{fullWidth:!0,multiline:!0,rows:4,placeholder:"Wpisz wszelkie dodatkowe informacje o wynikach lub samopoczuciu pacjenta...",value:n.notes,onChange:r=>g("notes",r.target.value),sx:{mt:1}})]})]}),i.jsxs(d,{sx:{display:"flex",gap:2,mt:4,mb:4,flexDirection:{xs:"column-reverse",sm:"row"},justifyContent:"flex-end"},children:[i.jsx(E,{variant:"outlined",onClick:()=>I(`/patients/${m}`),fullWidth:S,disabled:R,startIcon:i.jsx(X,{}),sx:{px:4,py:1.5,borderRadius:2,fontWeight:600},children:"Anuluj"}),i.jsx(E,{type:"submit",variant:"contained",disabled:R,fullWidth:S,startIcon:R?i.jsx(C,{size:20,color:"inherit"}):i.jsx(Y,{}),sx:{px:6,py:1.5,borderRadius:2,fontWeight:600,boxShadow:3},children:R?"Zapisywanie...":c?"Zaktualizuj wynik":"Zapisz wynik"})]})]})]});function a(r,s){const o=`${s}Unit`,e=`${s}RefLow`,j=`${s}RefHigh`;return i.jsxs(t,{container:!0,spacing:2,size:{xs:12},alignItems:"center",children:[i.jsx(t,{size:{xs:12,md:3},children:i.jsx(x,{variant:"subtitle1",fontWeight:600,color:"text.secondary",children:r})}),i.jsx(t,{size:{xs:6,sm:4,md:3},children:i.jsx(u,{fullWidth:!0,label:"Wynik",type:"number",size:"small",value:n[s],onChange:l=>g(s,l.target.value)})}),i.jsx(t,{size:{xs:6,sm:4,md:2},children:i.jsx(u,{fullWidth:!0,label:"Jedn.",size:"small",value:n[o],onChange:l=>g(o,l.target.value)})}),i.jsx(t,{size:{xs:6,sm:2,md:2},children:i.jsx(u,{fullWidth:!0,label:"Ref. dół",type:"number",size:"small",value:n[e],onChange:l=>g(e,l.target.value)})}),i.jsx(t,{size:{xs:6,sm:2,md:2},children:i.jsx(u,{fullWidth:!0,label:"Ref. góra",type:"number",size:"small",value:n[j],onChange:l=>g(j,l.target.value)})})]})}}export{ui as default};
