import{O as F,p as P,_ as S,r as R,j as e,B as d,T as l,P as T,t as c,C as W,q as B}from"./index-ik9JjyS6.js";import{u as A,a as D,C as g,o as G,s as M,c as N,l as Z}from"./schemas-Dohw0Ahx.js";import{C as O}from"./Container-U9Ph7Onl.js";import{A as y}from"./Alert-Dzq7_ew3.js";import{G as p}from"./Grid-OOY2WAvo.js";import{B as m}from"./Button-B6n5coYQ.js";import{T as U}from"./TextField-BNTsiTHM.js";import"./useThemeProps-C_QfMg4i.js";import"./Select--zggdXop.js";const $=G({photo:N(File,{message:"Proszę wybrać plik"}).refine(s=>s.size<=10*1024*1024,"Plik nie może być większy niż 10MB").refine(s=>s.type.startsWith("image/"),"Plik musi być obrazem"),notes:M().max(1e3,"Notatki mogą mieć maksymalnie 1000 znaków").optional().or(Z(""))});function Q(){const{id:s}=F(),h=P(),{enqueueSnackbar:x}=S(),[z,v]=R.useState(!1),{control:u,handleSubmit:w,formState:{errors:t,isSubmitting:b},watch:k}=A({resolver:D($),defaultValues:{photo:void 0,notes:""}}),r=k("photo"),C=async i=>{var a,n;try{const o=new FormData;o.append("photo",i.photo),i.notes&&o.append("notes",i.notes),await B.post(`/scalp-photos/patient/${s}`,o,{headers:{"Content-Type":"multipart/form-data"}}),v(!0),x("Zdjęcie przesłane pomyślnie!",{variant:"success"}),setTimeout(()=>{h(`/patients/${s}`,{state:{refresh:!0}})},1500)}catch(o){console.error("Błąd przesyłania zdjęcia:",o),x(((n=(a=o.response)==null?void 0:a.data)==null?void 0:n.error)||o.message||"Błąd przesyłania zdjęcia",{variant:"error"})}};return e.jsxs(O,{maxWidth:"md",sx:{py:4},children:[e.jsx(d,{sx:{mb:4},children:e.jsx(l,{variant:"h4",sx:{fontWeight:800,color:"#1d1d1f"},children:"Dodaj zdjęcie skóry głowy"})}),t.root&&e.jsx(y,{severity:"error",sx:{mb:3,borderRadius:2},children:t.root.message}),z&&e.jsx(y,{severity:"success",sx:{mb:3,borderRadius:2},children:"Zdjęcie przesłane pomyślnie!"}),e.jsx(T,{elevation:0,sx:{p:{xs:3,md:4},borderRadius:4,border:"1px solid",borderColor:"divider",bgcolor:"white"},children:e.jsx("form",{onSubmit:w(C),children:e.jsxs(p,{container:!0,spacing:4,children:[e.jsxs(p,{size:{xs:12},children:[e.jsx(g,{name:"photo",control:u,render:({field:{onChange:i,value:a,...n}})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{...n,accept:"image/*",style:{display:"none"},id:"photo-upload",type:"file",onChange:o=>{var j;const f=(j=o.target.files)==null?void 0:j[0];f&&i(f)}}),e.jsx("label",{htmlFor:"photo-upload",style:{width:"100%"},children:e.jsxs(d,{sx:{border:"2px dashed",borderColor:t.photo?"error.main":r?"#34C759":"#d2d2d7",borderRadius:3,p:4,textAlign:"center",cursor:"pointer",transition:"all 0.2s",bgcolor:r?c("#34C759",.02):c("#f5f5f7",.5),"&:hover":{borderColor:"#007AFF",bgcolor:c("#007AFF",.02)}},children:[e.jsx(l,{variant:"h6",sx:{color:"#1d1d1f",mb:1,fontWeight:700},children:r?"Zmieniono plik":"Wybierz zdjęcie lub przeciągnij"}),e.jsx(l,{variant:"body2",color:"text.secondary",children:r?r.name:"Dozwolone formaty: JPG, PNG (max 10MB)"}),e.jsx(m,{variant:"contained",component:"span",sx:{mt:3,bgcolor:"#007AFF",textTransform:"none",fontWeight:600,borderRadius:2},children:"Wybierz z dysku"})]})}),t.photo&&e.jsx(l,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:t.photo.message})]})}),r&&e.jsx(d,{sx:{mt:3,width:"100%",position:"relative",borderRadius:3,overflow:"hidden",border:"1px solid #d2d2d7"},children:e.jsx("img",{src:URL.createObjectURL(r),alt:"Podgląd",style:{width:"100%",maxHeight:"400px",objectFit:"contain",display:"block",backgroundColor:"#f5f5f7"}})})]}),e.jsx(p,{size:{xs:12},children:e.jsx(g,{name:"notes",control:u,render:({field:i})=>{var a;return e.jsx(U,{...i,fullWidth:!0,multiline:!0,rows:4,label:"Uwagi i opis zdjęcia",placeholder:"Np. widoczne zaczerwienienie w okolicach skroni...",error:!!t.notes,helperText:(a=t.notes)==null?void 0:a.message,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:3}}})}})}),e.jsx(p,{size:{xs:12},children:e.jsxs(d,{sx:{display:"flex",gap:2,pt:2},children:[e.jsx(m,{type:"submit",variant:"contained",disabled:b||!r,sx:{flex:1,py:1.5,bgcolor:"#1d1d1f",color:"white",textTransform:"none",fontWeight:700,borderRadius:3,boxShadow:"none","&:hover":{bgcolor:"#000",boxShadow:"none"},"&.Mui-disabled":{bgcolor:"#f5f5f7"}},children:b?e.jsx(W,{size:24,sx:{color:"white"}}):"Zapisz zdjęcie w dokumentacji"}),e.jsx(m,{variant:"outlined",onClick:()=>h(`/patients/${s}`),sx:{px:4,borderColor:"#d2d2d7",color:"#1d1d1f",textTransform:"none",fontWeight:600,borderRadius:3,"&:hover":{borderColor:"#1d1d1f",bgcolor:c("#000",.02)}},children:"Anuluj"})]})})]})})})]})}export{Q as default};
