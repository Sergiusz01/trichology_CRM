import{N as W,p as E,Y as P,n as S,o as A,r as M,q as g,j as e,B as z,T as Z,P as B,C as $}from"./index-DuGlS2hS.js";import{_ as C,Z as F,u as I,a as q,C as m,o as L,s as d,b as R,l as u}from"./schemas-CkMZXTd3.js";import{G as t}from"./Grid-9JmJah-6.js";import{T as l}from"./TextField-VtT5fMIl.js";import{M as h}from"./MenuItem-0hJOb36H.js";import{B as y}from"./Button-DYA-l7Ix.js";import"./useThemeProps-CESs6Os5.js";import"./Select-DgRGz9X7.js";function _(i){return C(F,i)}const G=L({firstName:d().min(2,"Imię musi mieć minimum 2 znaki").max(50,"Imię może mieć maksymalnie 50 znaków").regex(/^[a-zA-ZąćęłńóśźżĄĆĘŁŃÓŚŹŻ\s-]+$/,"Imię może zawierać tylko litery"),lastName:d().min(2,"Nazwisko musi mieć minimum 2 znaki").max(50,"Nazwisko może mieć maksymalnie 50 znaków").regex(/^[a-zA-ZąćęłńóśźżĄĆĘŁŃÓŚŹŻ\s-]+$/,"Nazwisko może zawierać tylko litery"),age:_().int("Wiek musi być liczbą całkowitą").min(0,"Wiek nie może być ujemny").max(150,"Wiek nie może przekraczać 150 lat").optional().or(u("")),gender:R(["MALE","FEMALE","OTHER",""]).optional(),phone:d().regex(/^[0-9\s\-\+\(\)]*$/,"Nieprawidłowy format telefonu").optional().or(u("")),email:d().email("Nieprawidłowy adres email").optional().or(u("")),occupation:d().max(100,"Zawód może mieć maksymalnie 100 znaków").optional().or(u("")),address:d().max(200,"Adres może mieć maksymalnie 200 znaków").optional().or(u(""))});function J(){const{id:i}=W(),j=E(),{enqueueSnackbar:x}=P(),w=S(),c=A(w.breakpoints.down("sm")),{control:o,handleSubmit:b,reset:k,formState:{errors:r,isSubmitting:f}}=I({resolver:q(G),defaultValues:{firstName:"",lastName:"",age:"",gender:"",phone:"",email:"",occupation:"",address:""}});M.useEffect(()=>{i&&i!=="new"&&N()},[i]);const N=async()=>{var s,a;try{const n=(await g.get(`/patients/${i}`)).data.patient;k({firstName:n.firstName||"",lastName:n.lastName||"",age:n.age||"",gender:n.gender||"",phone:n.phone||"",email:n.email||"",occupation:n.occupation||"",address:n.address||""})}catch(p){x(((a=(s=p.response)==null?void 0:s.data)==null?void 0:a.error)||"Błąd pobierania danych pacjenta",{variant:"error"})}},v=async s=>{var a,p;try{const n={firstName:s.firstName,lastName:s.lastName,age:s.age?Number(s.age):void 0,email:s.email||void 0,phone:s.phone||void 0,occupation:s.occupation||void 0,address:s.address||void 0,gender:s.gender||void 0};if(i&&i!=="new")await g.put(`/patients/${i}`,n),x("Pacjent zaktualizowany pomyślnie",{variant:"success"}),j(`/patients/${i}`);else{const T=await g.post("/patients",n);x("Pacjent utworzony pomyślnie",{variant:"success"}),j(`/patients/${T.data.patient.id}`)}}catch(n){x(((p=(a=n.response)==null?void 0:a.data)==null?void 0:p.error)||"Błąd zapisywania pacjenta",{variant:"error"})}};return e.jsxs(z,{children:[e.jsx(Z,{variant:"h4",gutterBottom:!0,children:i&&i!=="new"?"Edycja pacjenta":"Nowy pacjent"}),e.jsx(B,{sx:{p:3},children:e.jsx("form",{onSubmit:b(v),children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{size:{xs:12,sm:6},children:e.jsx(m,{name:"firstName",control:o,render:({field:s})=>{var a;return e.jsx(l,{...s,fullWidth:!0,required:!0,label:"Imię",error:!!r.firstName,helperText:(a=r.firstName)==null?void 0:a.message})}})}),e.jsx(t,{size:{xs:12,sm:6},children:e.jsx(m,{name:"lastName",control:o,render:({field:s})=>{var a;return e.jsx(l,{...s,fullWidth:!0,required:!0,label:"Nazwisko",error:!!r.lastName,helperText:(a=r.lastName)==null?void 0:a.message})}})}),e.jsx(t,{size:{xs:12,sm:6},children:e.jsx(m,{name:"age",control:o,render:({field:s})=>{var a;return e.jsx(l,{...s,fullWidth:!0,label:"Wiek",type:"number",error:!!r.age,helperText:(a=r.age)==null?void 0:a.message,inputProps:{min:0,max:150}})}})}),e.jsx(t,{size:{xs:12,sm:6},children:e.jsx(m,{name:"gender",control:o,render:({field:s})=>{var a;return e.jsxs(l,{...s,fullWidth:!0,select:!0,label:"Płeć",error:!!r.gender,helperText:(a=r.gender)==null?void 0:a.message,children:[e.jsx(h,{value:"",children:"Brak"}),e.jsx(h,{value:"MALE",children:"Mężczyzna"}),e.jsx(h,{value:"FEMALE",children:"Kobieta"}),e.jsx(h,{value:"OTHER",children:"Inna"})]})}})}),e.jsx(t,{size:{xs:12,sm:6},children:e.jsx(m,{name:"phone",control:o,render:({field:s})=>{var a;return e.jsx(l,{...s,fullWidth:!0,label:"Telefon",error:!!r.phone,helperText:(a=r.phone)==null?void 0:a.message,placeholder:"np. +48 123 456 789"})}})}),e.jsx(t,{size:{xs:12,sm:6},children:e.jsx(m,{name:"email",control:o,render:({field:s})=>{var a;return e.jsx(l,{...s,fullWidth:!0,label:"Email",type:"email",error:!!r.email,helperText:(a=r.email)==null?void 0:a.message,placeholder:"np. jan.kowalski@example.com"})}})}),e.jsx(t,{size:{xs:12},children:e.jsx(m,{name:"occupation",control:o,render:({field:s})=>{var a;return e.jsx(l,{...s,fullWidth:!0,label:"Zawód",error:!!r.occupation,helperText:(a=r.occupation)==null?void 0:a.message})}})}),e.jsx(t,{size:{xs:12},children:e.jsx(m,{name:"address",control:o,render:({field:s})=>{var a;return e.jsx(l,{...s,fullWidth:!0,label:"Adres",multiline:!0,rows:2,error:!!r.address,helperText:(a=r.address)==null?void 0:a.message})}})}),e.jsx(t,{size:{xs:12},children:e.jsxs(z,{sx:{display:"flex",gap:{xs:1,sm:2},justifyContent:"flex-end",flexDirection:{xs:"column-reverse",sm:"row"}},children:[e.jsx(y,{variant:"outlined",onClick:()=>j("/patients"),disabled:f,fullWidth:c,size:c?"medium":"large",sx:{fontSize:{xs:"0.875rem",sm:"1rem"},py:{xs:1.25,sm:1.5}},children:"Anuluj"}),e.jsx(y,{type:"submit",variant:"contained",disabled:f,fullWidth:c,size:c?"medium":"large",sx:{fontSize:{xs:"0.875rem",sm:"1rem"},py:{xs:1.25,sm:1.5}},children:f?e.jsxs(e.Fragment,{children:[e.jsx($,{size:20,sx:{mr:1}}),"Zapisywanie..."]}):c?"Zapisz":i&&i!=="new"?"Zapisz zmiany":"Utwórz pacjenta"})]})})]})})})]})}export{J as default};
